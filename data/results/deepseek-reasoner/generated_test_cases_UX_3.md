**Тест №1: Проверка добавления блока действий после события Start**  
**Предусловия:** Пользователь создал новую рассылку.  
**Действия:**  
1. Нажать "Добавить блок" рядом с событием Start.  
2. Выбрать тип действия "Отправка сообщения".  
**Ожидаемый результат:** Новый блок добавлен, связан с событием Start автоматически.  

---

**Тест №2: Валидация обязательного текста сообщения**  
**Предусловия:** Блок "Отправка сообщения" открыт для редактирования.  
**Действия:**  
1. Очистить поле "Текст сообщения".  
2. Нажать "Сохранить".  
**Ожидаемый результат:** Появилась ошибка "Поле обязательно для заполнения".  

---

**Тест №3: Использование макроса в тексте сообщения**  
**Предусловия:** В системе зарегистрирован макрос `{{customer_name}}`.  
**Действия:**  
1. Ввести `Привет, {{customer_name}}!` в поле "Текст сообщения".  
2. Сохранить блок.  
**Ожидаемый результат:** Макрос отображается корректно, сохранение прошло успешно.  

---

**Тест №4: Удаление блока с привязанными связями**  
**Предусловия:** Блок "Отправка сообщения" связан с событием Start и последующим блоком "Генерация события".  
**Действия:**  
1. Удалить блок "Отправка сообщения".  
**Ожидаемый результат:** Связи разорваны, блок удален. Последующие блоки остаются без изменений.  

---

**Тест №5: Проверка таймаута вызова внешней системы**  
**Предусловия:** В блоке настроен вызов внешней системы с URL `https://example.com`.  
**Действия:**  
1. Установить "Максимальное время выполнения запроса" = 0.  
2. Выполнить тестовый вызов.  
**Ожидаемый результат:** Запрос завершается через 0.5 сек (согласно фрагменту 4), отображается ошибка таймаута.  

---

**Тест №6: Конфликт параметров при генерации события**  
**Предусловия:** Создано событие с аргументом `phone_number`, используемым в рассылке.  
**Действия:**  
1. Попытаться удалить аргумент `phone_number`.  
**Ожидаемый результат:** Удаление запрещено, отображается предупреждение "Аргумент используется в рассылке".  

---

**Тест №7: Проверка сохранения состояния после перезагрузки**  
**Предусловия:** Пользователь добавил блок "Вызов внешней системы" и ввел URL.  
**Действия:**  
1. Обновить страницу.  
**Ожидаемый результат:** Данные блока восстановлены, связи сохранены.  

---

**Тест №8: Некорректный URL в вызове внешней системы**  
**Предусловия:** Открыт блок "Вызов внешней системы".  
**Действия:**  
1. Ввести URL `invalid_url`.  
2. Нажать "Сохранить".  
**Ожидаемый результат:** Ошибка "Некорректный URL", сохранение невозможно.  

---

**Тест №9: Отмена редактирования блока**  
**Предусловия:** Пользователь изменил текст сообщения, но не сохранил.  
**Действия:**  
1. Нажать "Отменить".  
**Ожидаемый результат:** Изменения откатываются к последней сохраненной версии.  

---

**Тест №10: Добавление нескольких действий в один блок**  
**Предусловия:** Блок "Отправка сообщения" уже содержит действие.  
**Действия:**  
1. Добавить второе действие "Генерация события" в тот же блок.  
**Ожидаемый результат:** Оба действия отображаются в блоке, порядок можно менять.  

---

**Тест №11: Проверка зависимостей чекбокса "Использовать авторизацию"**  
**Предусловия:** В блоке "Вызов внешней системы" включен чекбокс "Bearer авторизация".  
**Действия:**  
1. Отключить чекбокс.  
**Ожидаемый результат:** Поле для ввода токена скрыто.  

---

**Тест №12: Граничное значение времени жизни ссылки**  
**Предусловия:** Открыты настройки действия "Отправка сообщения с ссылкой".  
**Действия:**  
1. Ввести "Время жизни ссылки" = 0.  
**Ожидаемый результат:** Ссылка действует без ограничений (фрагмент 3).  

---

**Тест №13: Проверка множественного выбора аудитории**  
**Предусловия:** В настройках рассылки доступно несколько аудиторий.  
**Действия:**  
1. Выбрать две аудитории.  
**Ожидаемый результат:** Рассылка запускается для объединенной аудитории.  

---

**Тест №14: Обработка ошибки при вызове внешней системы**  
**Предусловия:** Блок содержит вызов нерабочего URL (`https://example.com/error`).  
**Действия:**  
1. Запустить тестовый вызов.  
**Ожидаемый результат:** Отображается ошибка "Сервер не отвечает", последующие действия блокируются.  

---

**Тест №15: Проверка обязательности параметров запроса**  
**Предусловия:** В блоке "Вызов внешней системы" добавлен параметр с пустым именем.  
**Действия:**  
1. Нажать "Сохранить".  
**Ожидаемый результат:** Ошибка "Имя параметра не может быть пустым".  

---

**Тест №16: Восстановление удаленного блока**  
**Предусловия:** Пользователь удалил блок "Генерация события".  
**Действия:**  
1. Нажать "Отменить" в истории изменений.  
**Ожидаемый результат:** Блок восстановлен вместе со связями.  

---

**Тест №17: Проверка валидации числового поля**  
**Предусловия:** Открыто поле "Максимальное время выполнения запроса".  
**Действия:**  
1. Ввести значение `-5`.  
**Ожидаемый результат:** Ошибка "Значение должно быть неотрицательным".  

---

**Тест №18: Конфликт имен макросов**  
**Предусловия:** Существует макрос `{{customer_name}}`.  
**Действия:**  
1. Попытаться создать новый макрос с именем `customer_name`.  
**Ожидаемый результат:** Ошибка "Макрос с таким именем уже существует".  

---

**Тест №19: Проверка порядка выполнения действий в блоке**  
**Предусловия:** Блок содержит два действия: "Вызов внешней системы" и "Отправка сообщения".  
**Действия:**  
1. Поменять порядок действий, переместив "Отправку сообщения" на первое место.  
2. Сохранить блок.  
**Ожидаемый результат:** Порядок изменен, но вызов внешней системы все равно выполняется первым (фрагмент 4).  

---

**Тест №20: Проверка отмены запуска рассылки с ошибками**  
**Предусловия:** В сценарии есть блок с несохраненными изменениями.  
**Действия:**  
1. Нажать "Запустить рассылку".  
**Ожидаемый результат:** Появилось предупреждение "Имеются несохраненные изменения", запуск отменен.