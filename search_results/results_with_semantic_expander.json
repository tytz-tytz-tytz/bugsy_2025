{
  "query": "Что протестировать при редактировании события?",
  "stemmed_tags": [
    "при",
    "протестирова",
    "редактирован",
    "событ",
    "что"
  ],
  "expanded_tags": [
    "аргумент",
    "блок",
    "валидац",
    "диалог",
    "идентификатор",
    "интерфейс",
    "макрос",
    "мессенджер",
    "настройк",
    "ограничен",
    "ошибк",
    "пользователь",
    "при",
    "протестирова",
    "рассылк",
    "редактирован",
    "событ",
    "тег",
    "тест",
    "тип",
    "что"
  ],
  "results": [
    {
      "section_id": "7_настройка_сценария_рассылки",
      "section_title": "Настройка сценария рассылки",
      "level": 0,
      "page_start": 16,
      "page_end": 47,
      "text": "Настройка сценария рассылки\nКонструктор  позволяет  задать  сценарий  рассылки,  который  будет  выполняться  для\nкаждого клиента из аудитории рассылки.\nСценарий рассылки состоит из:\n•  события Start;\n•  блоков действий;\n•  связей между блоками действий.\nПри создании рассылки в конструкторе автоматически создается событие Start, которое\nявляется  начальной  точкой  выполнения  сценария  рассылки.  Также  в  редакторе\nотображается  кнопка  «Добавить  блок»,  при  помощи  которой  в  рассылку  добавляются\nблоки  действий.  События  и  блоки  действий  соединяются  при  помощи  мыши,  образуя\nсвязи.\nВ простейшем случае сценарий рассылки представляет собой событие Start, связанное\nс одним блоком действий (см. Рисунок 19).\n16\nРисунок 19 — Создан сценарий простейшей рассылки\nСобытие Start\nСобытие  Start  происходит  при  запуске  рассылки.  После  возникновения  события  Start\nсразу  или  через  заданное  время  выполняются  связанные  с  ним  блоки  действий  (см.\nдалее).\nБлоки действий\nБлок может содержать одно или несколько действий следующих типов:\n1.  Отправка сообщения;\n2.  Отправка сообщения, содержащего конфиденциальные данные для клиента;\n3.  Перевод в канал;\n4.  Отмена отправки запланированных сообщений этой рассылки;\n5.  Отмена действия кнопок рассылки;\n6.  Вызов внешней системы;\n7.  Генерация события;\n8.  Генерация интента.\nОтправка сообщения\nСообщения могут содержать следующие элементы:\n1.  Текст  сообщения  —  текст,  который  будет  отправлен  клиенту  в  мессенджер.  Для\nввода текста используется поле стандартного блока действий (см. Рисунок 20);\n17\nРисунок 20 — Ввод текстового сообщения для отправки\nПри нажатии на id сообщения (на представленном рисунке это «916») будет открыто\nокно  редактирования,  которое  удобно  использовать  для  ввода  больших  текстов\nрассылок.\n2.  Медиа-контент  —  изображения,  видео,  аудио  и  документы,  которые  могут  быть\nдобавлены к сообщению. Поддерживаются наиболее распространенные форматы\n(см. таблицу 1).\nТаблица 1 — Рекомендуемые форматы файлов и их поддержка в мессенджерах\nТип\nФорматы\nВозможность загрузки файлов\nViber\nВКонтакте\nTelegram\nFacebook*\nInstagram1*\nJPG\nJPEG\nPNG\nMP4\nMP3\nPDF\nDOC(X)\nXLS(X)\nTXT\nИзображение\nВидео\nАудио\nДокумент\nВажно!\nДа\nДа\nДа\nДа\nНет\nНет\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nСписок  рекомендованных  форматов,  указанный  в  таблице\n1,  не  является\nисчерпывающим.  У  каждого  мессенджера  есть  свой  список,  который  со  временем\nможет  изменяться.  Кроме  того,  необходимо  учитывать,  что  мессенджеры  имеют  свои\nособенности отображения медиа-контента (например, Viber в некоторых случаях не\nпозволяет просматривать изображения в мессенджере).\n1  Отправка  возможна  для  всех  видов  контента.  При  этом,  для  всех  видов  контента,  кроме  изображений,\nотправляется только ссылка на него. Соответственно, клиент не сможет просматривать аудио, видео или\nдокумент  прямо  в  мессенджере  (для  этого  нужно  будет  воспользоваться  браузером  или  другим\nприложением.\n18\nВ  таблице  приведены  наиболее  универсальные форматы,  подходящие  для  отправки\nклиенту  в  большинство  мессенджеров.  Перед  запуском  рассылки  для  клиентов\nнеобходимо предварительно тестировать рассылки на всех мессенджерах.\nДополнительно  нужно  учитывать,  что  для  некоторых  мессенджеров  важно,  чтобы\nистинный  формат  файла  соответствовал  его  расширению  (т. е.  чтобы  изображение\nimage.png действительно имело содержимое, предусмотренное форматом PNG, а не,\nнапример, данные в формате JPEG).\nДля добавления медиа-контента необходимо в блоке действий нажать на кнопку\nв раскрывшемся меню выбрать пункт «Добавить медиа» (см. Рисунок 21).\nи\nРисунок 21 — Переход к добавлению медиа-контента\nЗатем нужно задать тип медиа-контента и ввести ссылку (URL) на него, либо загрузить\nс компьютера при помощи кнопки\n(см. Рисунок 22).\nРисунок 22 — Добавление медиа-контента\n3.  Медиа группа — изображения и видео, которые могут быть добавлены к сообщению\nгруппой.\nВ  отличии  от  предыдущего  пункта,  медиа  группа  позволяет  отправлять  клиенту\nзаранее не определенное количество изображений и видео. Это удобно, например,\nдля  информирования  клиентов  о  результате  проведенных  работ,  когда  одному\n19\nклиенту  нужно  отправить  10  фотографий,  а  другому  15.  С  помощью  медиа  групп  это\nможно сделать одной рассылкой2.\nВторое отличие от одиночных медиа состоит в том, что с медиа группа отправляются\nклиенту  одним  сообщением3,  тогда  как  одиночные  медиа  отправляются  каждое  в\nотдельном сообщении.\nВ  группах  могут  отправляться  только  изображения  и  видео,  документы  и  аудио\nотправляться не могут.\nДля  добавления  группы  необходимо  в  блоке  действий  нажать  на  кнопку\nраскрывшемся меню выбрать пункт «Добавить медиа группу» (см. Рисунок 23).\nи  в\nРисунок 23 — Добавление медиа группы\nВ  открывшемся  окне  можно  добавлять  и  редактировать  ссылки  на  файлы,  которые\nбудут отправляться вместе с указанным сообщением (Рисунок 24).\nРисунок 24 — Редактор медиа групп\n2  Для  реализации  этого  сценария  необходимо  использовать  макросы,  см.  в  разделе  «Использование\nмакросов»\n3  Возможности просмотра одиночных и групп медиа («карусель», предпросмотр в виде плиток и т.д.) зависят\nот мессенджера.\n20\nВ  поле  URL  можно  вставить  как  сам  URL  изображения,  так  и  макрос  (подробнее  о\nмакросах в разделе «Использование макросов»).\nДля  загрузки  файлов  с  устройства  используется  кнопка\n.  Для  клонирования\nэлементов  –\nпоявившемся списке выбрать тип: изображение, видео или макрос.\n.  Для  выбора  типа  файла  необходимо  нажать  на  иконку\nи  в\nЗагруженные элементы отображаются справа. В правой области элементы можно как\nудалять  при  наведении  мышки  и  нажатии  на  кнопку  корзины,  так  и  перемещать  –\nкликнув мышкой на элемент и перетянуть в нужное место см. Рисунок 25.\nВ  левой  области\nтакже  можно  перетаскивать  элементы  и  менять  их\nпоследовательность.  Для  этого  необходимо  кликнуть  мышкой  на  элемент\nперетащить его в нужное место.\nи\nРисунок 25 — Взаимодействие с элементами в правой панели\nВажно!\nМаксимальное количество элементов в медиа группе равно 50. К одному текстовому\nсообщению может быть присоединена только одна медиа группа.\nВо всех полях медиа группы можно использовать макросы.\nРассмотрим случай, когда рассылка с медиа группой будет отправляться клиентам\nпо событию.  Ссылки на изображения мы хотим задавать динамически, в аргументах\nсобытия,  чтобы  мы  могли  отправить  одному  клиенту  11  фотографий,  а  другому  20  из\nодной рассылки. Для этого необходимо:\n1.  Создать  событие,  у  которого  будет  30  аргументов  (это  будет  максимальное\nчисло изображений в медиа группе в этом примере) (Рисунок 26);\n21\nРисунок 26 — Создание события для отправки изображений в медиа группе\n2.  Создать рассылку и настроить ее на начало по этому событию;\n3.  В конструкторе рассылки в блок добавить медиа группу;\n4.  В  медиа  группу  добавить  то  же  самое  количество  URL,  что  и  в  аргументах\nсобытия (см. Рисунок 27);\nРисунок 27 — Использование макросов с изображениями\n5.  В поле URL ввести аргументы события в фигурных скобках, указав в каждом поле\nтолько один аргумент, тип файла оставить как изображение (см. Рисунок 27);\n6.  Сохранить медиа группу.\n22\nПосле этого необходимо сгенерировать событие и в аргументах события указать\nссылки на файлы для отправки клиенту в мессенджер см. Рисунок 28.\nРисунок 28 — Генерация события с аргументами\nЕсли рассылка должна отправлять не только изображения в медиа группе, но и видео,\nтогда в макросах нужно передавать еще и тип медиа. Для этого в аргументах события\nнеобходимо  создать  в  два  раза  больше  аргументов,  чтобы  для  каждого  URL\nпередавался еще и тип, например см. Рисунок 29:\nРисунок 29 — Создания аргументов события для медиа группы\nВ настройках медиа группы для каждого URL выбираем тип \"Макрос\" и задаем URL и\nего тип макросами, как показано на Рисунок 30.\n23\nРисунок 30 — Создания медиа группы с разными типами\nПосле этого необходимо сгенерировать событие и в аргументах события указать\nссылки на файлы и типы для отправки клиенту в мессенджер, например, см. Рисунок\n31.\nРисунок 31 — Генерация события для медиа группы с типами медиа\n4.  Кнопки-действия — это кнопки, позволяющие выполнять следующие действия:\n•  Вызвать другой блок действий;\n•  Добавить клиенту теги;\n•  Снять теги с клиента;\n•  Отписать клиента от рассылок (всех)4.\nДля добавления кнопки-действия необходимо в блоке действий нажать на кнопку\nи в раскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 32).\n4 Действие эквивалентно тому, что клиент напишет боту команды «стоп рассылки» или «stop subscriptions»,\nсм. раздел Отписка от рассылок.\n24\nРисунок 32 — Переход к добавлению кнопки-действия\nЗатем  нужно  задать  требуемые  параметры  кнопки  и  нажать  на  кнопку  «Сохранить»\n(см.  Рисунок  33).  Для  каждой  кнопки  можно  указать  теги,  которые  будут  назначены\nклиенту (сняты с клиента), подробнее об этом см. в подразделе Работа с тегами.\nРисунок 33 — Добавление кнопки-действия\nПримечание:\nДлина заголовка кнопки должна быть не более 20 символов.\nДействия  в  блоке,  связанном  с  кнопкой,  всегда  выполняются  сразу  после  нажатия\nкнопки.  (см.  Рисунок  34).  Блок,  вызываемый  кнопкой-действием,  может  содержать\nлюбое из действий, описанных в разделе Блоки действий.\n25\nРисунок 34 — Второй блок выполняется сразу при нажатии на кнопку\nНа  одну  кнопку  клиент  может  нажать  только  один  раз.  Повторные  нажатия  не\nобрабатываются.  Если  сценарий  рассылки  предусматривает  возврат  к  блоку,\nкоторый клиент уже получал, то на кнопку можно будет нажать еще раз (см.  Рисунок\n35). В этом примере при нажатии на кнопку «Назад» клиент получит первый блок еще\nраз и именно в нем можно будет еще раз нажать на кнопку «Подробнее».\nРисунок 35 — Пример возврата\nПри  добавлении  к  сообщению  более  двух  кнопок-действий  появляется  опция\n«Разрешить только одно нажатие» (см. Рисунок 36).\nЕсли  она  установлена,  то  клиент  может  нажать  только  на  одну  кнопку  в  этом\nсообщении.  После  первого  нажатия  аналогичные  нажатия  по  другим  кнопкам  не\nобрабатываются.  Если  опция  не  установлена,  то  на  каждую  кнопку  в  сообщении\nможно нажать один раз.\n26\nРисунок 36 — В блок добавлено две кнопки-действия\nВажно!\nОписанное выше относится только к кнопкам сообщения, а не блока. В один блок может\nбыть добавлено несколько сообщений, каждое из которых будет содержать по нескольку\nкнопок. В этом случае при включенной опции «Разрешить только одно нажатие» в каждом\nсообщении можно будет нажать по одной кнопке.\nВ некоторых мессенджерах текст сообщений с кнопками может обрезаться. Т.е. клиент\nувидит  не  весь  отправленный  ботом  текст,  а  только  первые  несколько  символов.\nПредупреждение об этом всплывет справа у окна с текстом см. Рисунок 37. Например, в\nмобильной  версии  Viber  будет  отображаться  только  первые  40  символов  сообщения  с\nкнопкой, а в десктопной версии – первые 10.\nРисунок 37 - Текст с кнопкой, который обрежется в некоторых мессенджерах\nЧтобы  обойти  эту  проблему  рекомендуем  добавлять  отдельное  сообщение  перед\nсообщением с кнопкой и задавать в нем основной текст, а в сообщении с кнопкой писать\nчто-то короткое см. Рисунок 38.\n27\nРисунок 38 - Добавлено отдельное сообщение\n5.  Кнопки-ссылки  —  кнопки,  позволяющие  клиенту  перейти  по  заданной  ссылке  из\nмессенджера.\nДля добавления кнопки-ссылки необходимо в блоке действий нажать на кнопку\nраскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 39).\nи в\nРисунок 39 — Переход к добавлению кнопки-ссылки\nЗатем необходимо задать название кнопки и ссылку для нее (см. Рисунок 40).\nРисунок 40 — Создание кнопки-ссылки\n28\nСсылка  клиенту  не  отображается.  Нажатия  на  кнопку-ссылку  не  могут  приводить  к\nзапуску  другого  блока  или  иным  действиям,  а  также  никак  не  учитываются  в\nстатистике.\nПримечание:\nКлиент  может  нажимать  на  ссылки  многократно,  описанные  выше  ограничения  по\nнажатиям на них не действуют.\nОтправка сообщения, содержащего конфиденциальные данные для клиента\nВ  общем случае  вся  переписка клиента  с  ботом доступна  оператору  Maxbot. Если  бот\n(например,  кодов\nиспользуется  для  отправки  конфиденциальной  информации\nподтверждения), то такую информацию необходимо скрывать от оператора.\nДля  отправки  конфиденциальной  информации  в  теле  блока  с сообщением  необходимо\nиспользовать  тег  <security>…</security>  (см  Рисунок  41).  Вставка  закрывающего  тега\nобязательна.\nРисунок 41 — Отправка конфиденциальной информации при помощи тега <security></security>\nДанные, заключенные в теге <security>, для оператора заменяются на ***. То, что увидят\nклиент и оператор при запуске такой рассылки, показано на рисунке ниже:\nРисунок 42 — Отображение содержимого тега <security> для клиента и для оператора\nНа  практике  использование  тега  <security>  будет  сопровождаться  использованием\nмакроса,  т. е.  конфиденциальная  информация  вряд  ли  будет  задаваться  в  рассылке\nстатически.  В  этом  случае  тег  <security>  нужно  использовать  следующим  образом  (см.\nРисунок 43), поместив внутрь макрос, который является аргументом события:\n29\nРисунок 43 — Использование значения макроса в качестве конфиденциальной информации\nПеревод в канал\nДействие перевода в канал выполняется сразу, если диалог у клиента закрыт или диалог\nсвободный5  или  иное  на  задано  в  настройках  действия  (см.  далее).  При  наличии\nоткрытого диалога перевод выполнен не будет, чтобы не помешать текущему общению\nклиента  с  оператором.  Перевод  будет  отложен  до  тех  пор,  пока  диалог  у  клиента  не\nбудет закрыт или не будут выполнены условия, заданные в настройках действия.\nДля добавления действия перевода в канал нужно нажать на кнопку\nи в раскрывшемся\nменю  выбрать  пункт  «Действие»,  после чего  выбрать  «Перевести  в  канал»  (см.  Рисунок\n44):\nРисунок 44 — Выбор действия\nЗатем в открывшемся окне (см. Рисунок 45) необходимо задать параметры для действия\nперевода в канал.\nВ окне доступны следующие настройки:\n•  Выберите канал — канал, в который необходимо перевести клиента;\n5 Свободный диалог — диалог, у которого канал Bot.\n30\n•  Текст  при  переводе  в  канал  —  сообщение,  которое  будет  отправлено  клиенту  при\nпереводе в канал (если оставить его пустым, то сообщение не будет отправляться);\n•  Текст  при  откладывании  перевода  в  канал  —  сообщение,  которое  будет  оправлено\nклиенту,  если  в  момент  выполнения  действия  у  него  есть  открытый  диалог  и  он  не\nсвободный (т. е. клиент обсуждает с оператором или ботом какой-то вопрос);\n•  Текст перед отложенным переводом в канал — сообщение, которое будет отправлено\nклиенту при переводе в канал, если он ранее был отложен;\n•  Переключатель условия перевода в канал:\n•  Перевести сразу (значение по умолчанию) — клиент будет переведен в канал без\n(кроме  наличия  открытого/свободного\nкаких-либо  дополнительных  условий\nдиалога);\n•  Перевести  после  получения  сообщения  от  клиента  —  клиент  будет  переведен\nтолько  после  получения  от  него  сообщения  и  в  соответствии  с  настройками,\nуказанными ниже;\nРисунок 45 — Настройка действия перевода в канал\n31\n•  Время ожидания сообщения — время, которое бот ожидает сообщения от клиента для\nперевода  его  в  канал.  Можно  установить  время  не  более  2  часов  (ограничение\nвведено,  чтобы  маркетолог  не  мог  надолго  «блокировать»  клиента:  поскольку  в\nмомент ожидания не могут выполняться другие рассылки, а также клиенту не смогут\nотправлять сообщения операторы);\n•  Если  клиент  не  ответил  за  заданное  время  —  действие,  которое  бот  выполнит,  не\nдождавшись сообщения от клиента в течение «времени ожидания сообщения»:\n•  «Ничего не делать» — бот не будет предпринимать каких-либо действий; клиент не\nбудет переведен в канал, рассылка при этом продолжится согласно сценарию;\n•  «Перевести  в  канал  безусловно»  —  клиент  будет  переведен  в  канал,  при  этом\nможно задать другой канал (отличный от исходно заданного);\n•  «Отправить сообщение» — клиенту будет отправлено сообщение, заданное в поле\nниже; клиент не будет переведен в канал.\nЕсли для рассылки ниже (см. Рисунок 46) задать безусловный перевод клиента в канал по\nфакту  нажатия  на  кнопку  «Оставить  отзыв»,  то  клиент  будет  переведен  сразу,  какого-\nлибо сообщения от него не требуется.\nРисунок 46 — Пример рассылки с переводом в канал\nВ  этом  случае  оператор  увидит  нового  клиента  в  списке  диалогов,  но  сообщение  от\nклиента будет отсутствовать (см. Рисунок 47).\nРисунок 47 — Клиент переведен в канал без сообщения\n32\nЕсли  же  в  настройках  перевода  в  канал  потребовать  ввод  сообщения  от  клиента  (см.\nРисунок 48), то новый диалог появится только после отправки клиентом сообщения.\nРисунок 48 — Ввод условия перевода клиента в канал только при наличии от него сообщения\nВ этом случае оператор уже сразу увидит текст сообщения и не будет тратить время на\nвыяснение причины и содержания обращения (см. Рисунок 49).\nРисунок 49 — Клиент переведен в канал после отправки им сообщения\nОтмена отправки запланированных сообщений\nЭто  действие  позволяет  маркетологу  остановить  рассылку  для  клиента  при\nвозникновении  некоторого  события.  Например,  при  нажатии  кнопки,  при  отправке\nфинального сообщения рассылки, при истечении определенного времени.\nДля  добавления  действия  нужно  нажать  на  кнопку\nи  в  раскрывшемся  меню  выбрать\nпункт «Действие», после чего выбрать «Отключить рассылку запланированных, но еще не\nотправленных сообщений» (см. Рисунок 50):\n33\nРисунок 50 — Выбор действия\nНа  рисунке  51  показан  пример  такого  сценария.  Если  клиент  нажмет  на  кнопку  «Не\nинтересуюсь  этим»,  робот  отправит  извинительное  сообщение  и  отключит  отправку\nзапланированных сообщений. В данном случае это правое нижнее сообщение, которое\nпредполагалось отправить через 5 дней.\nЕсли  клиент  в  течение  5  дней  не  нажмет  эту  кнопку,  то  он  получит  запланированное\nсообщение с информацией о продлении акции.\nРисунок 51 — Пример использования события отмены отправки запланированных сообщений\nВажно!\nДействие отмены отправки запланированных сообщений применяется ко всей рассылке\nдля текущего клиента, независимо от того, из какой ветви сценария оно было вызвано.\n34\nОтмена работы уже отправленных в рассылку кнопок\nЭто  действие  работает  аналогично  предыдущему,  только  отменяет  не  отправку\nсообщений, а работу кнопок в сообщениях. Вместе с предыдущим действием позволяет\nполностью деактивировать рассылку для клиентов, у которых они будут выполнены.\nи  в  раскрывшемся  меню  выбрать\nДля  добавления  действия  нужно  нажать  на  кнопку\nпункт «Действие», после чего выбрать «Отключить работу уже отправленных в рассылку\nкнопок» (см. Рисунок 52):\nРисунок 52 — Выбор действия\nВ следующем сценарии (см. Рисунок 53) при нажатии на кнопку «Не интересуюсь этим»\nпроизойдет не только отмена запланированного сообщения, но и перестанет работать\nкнопка, отправленная клиенту в первом сообщении.\nРисунок 53 — Использование действия отмены работы уже отправленных в рассылку кнопок\n35\nВажно!\nЭто  действие  отменяет  только  работу  кнопок-действий.  Кнопки-ссылки  будут  всегда\nдоступны, клиенты смогут переходить по ним произвольное число раз.\nДействие  отмены  работы  кнопок  применяется  ко  всей  рассылке  для  текущего  клиента,\nнезависимо от того, из какой ветви сценария оно было вызвано.\nВызов внешней системы\nДействие  «Вызвать  внешнюю  систему»  предназначено  для  уведомления  внешней\nсистемы о достижении клиентом того или иного этапа рассылки.\nи в раскрывшемся\nДля добавления вызова внешней системы нужно нажать на кнопку\nменю  выбрать  пункт  «Действие»,  после  чего  выбрать  «Вызвать  внешнюю  систему»  (см.\nРисунок 54).\nРисунок 54 — Выбор действия\nДалее необходимо задать параметры запроса к внешней системе. Для примера далее\nзаполнено  обращение  к  CRM  компании  для  того,  чтобы  отметить  интерес  клиента  к\nопределенной  теме  в  случае  нажатия  на  определенную  кнопку  (см.  Рисунок  55).  В\nдальнейшем в CRM это можно будет использовать для сегментации аудитории.\nПример  ниже  отражает  вариант  запроса,  при  выполнении  которого  в  CRM  компании\nсохраняются данные о том, что клиент с идентификатором 12443 интересуется товарами\nв категории «наушники» (headphones).\nКроме  строковых  и  числовых  параметров  также  могут  использоваться  макросы,  см.\nподробнее в разделе Использование макросов.\n36\nРисунок 55 — Ввод параметров запроса к внешней системе\nЕсли в блоке есть действие вызова внешней системы, то оно всегда выполняется первым.\nЕсли вызов завершается ошибкой (сервер возвращает HTTP-статус, отличный от 200 или\nне  отвечает  в  течение  времени,  заданного  в  поле  «Максимальное  время  выполнения\nзапроса»), то остальные действия блока не выполняются. Если к текущем блоку привязаны\nпоследующие блоки (т. е. выполняются после отправки сообщения из этого блока), то они\nтакже не будут выполнены.\nПримечание:\nВ текущей версии «Максимальное время выполнения запроса» и все подобные таймауты\nвременно равны 0.5 секунды вне зависимости от заданного значения.\nГенерация события\nБлок  этого  типа  позволяет  вызывать  события  и  использовать  их  для  запуска  других\nрассылок из текущей рассылки.\nЕсли клиент по сценарию рассылки перейдет к действию «Сгенерировать событие», то\nэто  событие  будет  сгенерировано  либо  только  для  него;  если  для  события  задана\nфиксированная  аудитория  (см.  подробнее  в  разделе  Определение  аудитории),  то\nсобытие  будет  сгенерировано  для  нее  (будет  запущена  рассылка  для  множества\n37\nклиентов). Это позволит начать одну или несколько других рассылок. Текущая рассылка\nпри этом не будет остановлена, ее сценарий продолжит выполняться.\nРисунок 56 — Выбор действия «Сгенерировать событие\nНапример,  есть  рассылка,  предлагающая  клиенту  воспользоваться  промокодом  (см.\nРисунок 57). Если клиент нажимает на кнопку, то во втором блоке рассылки генерируется\nсобытие «Создание промокода для клиента».\nПримечание:\nСобытие,  используемое  в  сценарии  рассылки,  должно  быть  предварительно  создано.\nПодробнее об этом см. в разделе Использование событий.\nРисунок 57 — Рассылка, в сценарии которой генерируется событие для клиента\nВ аргументах события, генерируемого для клиента, нужно задать требуемые значения. В\nнашем случае нужно задать значения для 3-х аргументов (см. Рисунок 58):\n•  промокод — строка;\n38\n•  размер скидки (%) — число;\n•  действует до — строка.\nРисунок 58 — Событие «Создание промокода для клиента» и его аргументы\nПример ввода значений аргументов события показан на рисунке 59.\nПри  указании  строковых  значений  необходимо  использовать  символ  кавычек  (“);\nчисловые значения и даты задаются без кавычек. Значение аргумента также может быть\nпустым (не задано).\nПри этом могут быть заданы как статические значения аргументов (в примере выше), так\nи динамические — макросы, уникальные для каждого клиента.\nПереключатель  под  названием  события  определяет,  для  кого  будет  сгенерировано\nсобытие:\n•  только для текущего клиента\nили\n•  для множества клиентов (для рассылок с фиксированной аудиторией).\n39\nРисунок 59 — Ввод аргументов для события\nТеперь  можно  создать  вторую  рассылку,  которая  будет  выполняться  при  генерации\nсобытия в первой рассылке. Ниже пример такой рассылки (см. Рисунок 60):\nРисунок 60 — Вторая рассылка, запускаемая по сгенерированному событию и использующая\nзначения аргументов события\nПримечание:\nЕсли  рассылка  запускается  по  событию,  то  его  аргументы  можно  использовать  в\nрассылке  как макросы.  На  рисунке  выше  во  второй  рассылке  при  помощи  скобок  {{  }}\nиспользуются значения аргументов сгенерированного события.\nДля данной рассылки нужно выбрать условие «Начинать при возникновении события» и\nсобытие  «Создание  промокода  для  клиента»  (см.  Рисунок  61),  после  чего  запустить  ее.\nРассылка будет «ожидать» выбранного события и выполнится у клиентов, для которых оно\nнаступило.\n40\nРисунок 61 — Определение условий начала второй рассылки\nЕсли  в  результате  выполнения  первой  рассылки  (см.  Рисунок  57)  клиент  нажмет  кнопку\n«Получить  промокод»,  то  в  результате  выполнения  второй  рассылки  будут  получены\nданные промокода (см. Рисунок 62).\nРисунок 62 — После нажатия на кнопку «Получить промокод» для клиента выполнилась вторая\nрассылка\nГенерация интента\nБлок  этого  типа  позволяет  сгенерировать  интент  (intent)  —  намерения  пользователя,\nкоторые могут быть распознаны системой для того, чтобы затем вызвать определенный\nнавык бота.\n41\nДля вызова навыков бота необходимо:\n1.  Нажать  на  кнопку\nи  в  раскрывшемся меню  выбрать  пункт «Действие»,  после  чего\nвыбрать «Сгенерировать intent» (см. Рисунок 63).\nРисунок 63 — Выбор действия «Сгенерировать intent»\n2.  В  настройках  действия  (см.  Рисунок  64)  задать  название  интента  и  (необязательно)\nсловарь сущностей (entities). Важно, что в поле «Entities» должен быть задан именно\nсловарь в формате JSON (как на рисунке ниже), иначе выполнение сценария рассылки\nзавершится ошибкой.\nВ словаре могут быть использованы как макросы и переменные окружения (в нотации\n«slots.m.macros_name»),  так  и  статические  значения.  Этот  словарь  должен  быть\nвалидным jinja-выражением.\nКонстантные выражения также нужно задавать правильно — строки только в кавычках,\nчисла — без, и они не должны оставаться пустыми.\nРисунок 64 — Ввод параметров интента\n42\n3.  Нажать на кнопку «Сохранить».\nВ результате выполнения этого действия бот сгенерирует указанный интент и передаст\nslots  в  качестве  параметров.  Это  позволит  запустить  нужный  навык  бота  для  клиента\n(например, выбор определенного товара или услуги).\nПримечание:\nЧтобы бот выполнил определенное действие, навыки бота должны быть предварительно\nнастроены.\nВ перспективе это действие должно вытеснить большинство переводов в канал – вместо\nтого,  чтобы  передавать  клиента  оператору  и  занимать  его  время,  рассылка  будет\nвызывать соответствующий навык бота.\nБлок-комментарий\nВ  рассылки любого  типа  можно  вставить блок-комментарий,  который  будет содержать\nпроизвольный текст. Для добавления блока-комментария к рассылке необходимо в левом\nнижнем  углу  нажать  на  кнопку  «Добавить  блок»,  после  чего  выбрать  значение\n«Комментарий» (см. Рисунок 65) и перетащить его на область сценария рассылки.\nРисунок 65 — Добавления блока-комментария\nБлок  данного  типа  является  информационным:  он  не  имеет  каких-либо  настроек  (за\nисключением текста комментария) и не может иметь связей с другими блоками рассылки.\nБлок «SMS-сообщения»\nВ  рассылку  также  можно  добавить  блок  «SMS-сообщения»,  выбрав  соответствующий\nпункт  в  меню  добавления  блоков  (см.  Рисунок  66).  Блок  позволяет  отправлять  клиентам\nSMS-сообщения,  а  также  направлять  клиентов  на  посадочную  страницу  для\nподключения мессенджера и автоматического подтверждения номера телефона.\nПодробнее  об  использовании  блока  «SMS-сообщения»  см.  в  разделе  Настройка  SMS-\nрассылок.\n43\nРисунок 66 — Добавления блока «SMS-сообщения»\nПримечание:\nПо  умолчанию  после  создания  рассылки  добавление  блока  «SMS-сообщения»\nнедоступно. Для разблокирования этой возможности необходимо сначала выбрать SMS-\nпровайдера,  см.  подробнее  в  разделах  Регистрация  SMS-провайдера  и  Добавление\nSMS-провайдера в рассылку.\nБлок «Форма»\nПри  необходимости  проведения  опроса  клиентов  можно  добавить  в  рассылку  блок\n«Форма»  (см.  Рисунок  67).  Блок  позволяет  при  помощи  конструктора  задать  порядок\nпроведения опроса, а также форматы вопросов и ответов.\nПодробнее о возможностях данного блока и особенностях его применения в рассылках\nсм. в разделе Опрос клиентов с помощью форм.\nРисунок 67 — Добавления блока «Форма»\nСвязи между блоками действий\nСвязь между событием и блоком означает безусловное выполнение действий блока сразу\nили через заданный промежуток времени после возникновения события.\nТаким  образом,  связь  всегда  исходит  из  событий  и  заканчивается  в  блоке  действий.  В\nодин блок действий могут приходить несколько связей.\n44\nСписок событий, из которых может исходить связь:\n1.  Событие Start, т. е. начало выполнения сценария рассылки (см. Рисунок 68);\nРисунок 68 — Связь исходит из события Start\n2.  Нажатие на кнопку-действие (см. Рисунок 69);\nРисунок 69 — Связь исходит из кнопки «Узнать подробности»\n3.  Отправка  сообщения  клиенту.  От  события  отправки  сообщения  также  можно\nстроить связь, для этого следует начать связь из точки в правом нижнем углу (см.\nРисунок  70).  Важно,  что  это  событие  происходит  только  когда  сообщение\nнепосредственно ставится в очередь на отправку, а не когда сообщение должно\nбыло отправиться.\nНапример,  в  приведенном  ниже  рисунке  второе  сообщение  должно  отправиться\nчерез 5 дней. Если первое сообщение не отправилось сразу после начала рассылки\n(например, у клиента был открыт диалог и его закрыли только через 1 день), то второе\nотправится  только  через  5  дней  после  отправки  первого,  т. е.  через  6  дней  после\nначала  рассылки  (а  не  через  5,  как  это  может  показаться  из  сценария).  Поэтому\nрассылки с подобными связями могут растягиваться на неопределенное время.\n45\nРисунок 70 — Связь исходит из блока с сообщением\nИз  события  Start  может  исходить  произвольное  количество  связей.  Из  остальных\nсобытий — только  по  одному.  У  всех  связей,  кроме  тех,  что  исходят  из  кнопок,  можно\nзадать задержку (см. Рисунок 70).\nТакже стоит отметить, что этой точки в правом нижнем углу нет, если в блоке нет действия\nотправки сообщения (не от чего отталкиваться).\nДублирование блоков\nЕсли  необходимо  быстро  скопировать  блок  со  всем  его  содержимым,  то  необходимо  в\nверхней части нажать на\nРисунок 71).\nи затем в раскрывшемся меню выбрать «Дублировать» (см.\nРисунок 71 — Вызов функции дублирования блока\nУпорядочивание сообщений в блоке\nЕсли  блок  имеет  несколько  сообщений,  то  их  можно  упорядочить.  Чтобы  сделать  это,\nнеобходимо  нажать  напротив  нужного  сообщения  на\n,  затем  в  открывшемся  меню  с\nпомощью  пунктов  «Переместить  наверх»  и  «Переместить  вниз»  определить\nместоположение сообщения (см. Рисунок 72).\n46\nРисунок 72 — Определение местоположения сообщения\nУдаление сообщений из блока\nНенужные сообщения из блока можно удалить. Чтобы сделать это, нужно нажать напротив\n, в открывшемся меню выбрать пункт «Удалить» (см. Рисунок 73), затем во\nсообщения на\nвсплывающем окне подтвердить удаление.\nРисунок 73 — Удаление сообщения из блока\n47\nКонтроль  изменения  сценария  и  настроек  рассылки  в\nнескольких окнах браузера\nВ  Maxbot  функционирует  механизм,  отслеживающий  редактирование  сценария  и\nнастроек  рассылки  в  разных  окнах  (вкладках)  браузера.  Это  сделано  для  того,  чтобы\nправки в ранее открытой вкладке не могли «затереть» изменения, сделанные в другой.\nМеханизм контроля работает следующим образом. Например, если открыть рассылку в\nдвух  вкладках,  отредактировать  ее  в  первой  вкладке,  а  затем  попытаться\nотредактировать  во  второй,  то  будет  отображено  следующее  сообщение  (см.  Рисунок\n74).  Аналогичное  сообщение  будет  отображено  в  случае,  когда  одна  рассылка\nодновременно редактируется двумя или более маркетологами\nРисунок 74 — Ошибка при одновременном редактировании сценария в разных вкладках\nбраузера\nВ  этом  случае  необходимо  обновить  страницу  для  продолжения  редактирования\nсценария  рассылки  в  этом  окне.  Изменение,  которое  привело  к  появлению  этого\nсообщения, не сохранится.",
      "tags": [
        "аргумент",
        "блок",
        "диалог",
        "идентификатор",
        "макрос",
        "мессенджер",
        "настройк",
        "ограничен",
        "ошибк",
        "рассылк",
        "редактирован",
        "событ",
        "тег",
        "тест",
        "тип"
      ]
    },
    {
      "section_id": "9_блоки_действий",
      "section_title": "Блоки действий",
      "level": 1,
      "page_start": 17,
      "page_end": 42,
      "text": "Блоки действий\nБлок может содержать одно или несколько действий следующих типов:\n1.  Отправка сообщения;\n2.  Отправка сообщения, содержащего конфиденциальные данные для клиента;\n3.  Перевод в канал;\n4.  Отмена отправки запланированных сообщений этой рассылки;\n5.  Отмена действия кнопок рассылки;\n6.  Вызов внешней системы;\n7.  Генерация события;\n8.  Генерация интента.\nОтправка сообщения\nСообщения могут содержать следующие элементы:\n1.  Текст  сообщения  —  текст,  который  будет  отправлен  клиенту  в  мессенджер.  Для\nввода текста используется поле стандартного блока действий (см. Рисунок 20);\n17\nРисунок 20 — Ввод текстового сообщения для отправки\nПри нажатии на id сообщения (на представленном рисунке это «916») будет открыто\nокно  редактирования,  которое  удобно  использовать  для  ввода  больших  текстов\nрассылок.\n2.  Медиа-контент  —  изображения,  видео,  аудио  и  документы,  которые  могут  быть\nдобавлены к сообщению. Поддерживаются наиболее распространенные форматы\n(см. таблицу 1).\nТаблица 1 — Рекомендуемые форматы файлов и их поддержка в мессенджерах\nТип\nФорматы\nВозможность загрузки файлов\nViber\nВКонтакте\nTelegram\nFacebook*\nInstagram1*\nJPG\nJPEG\nPNG\nMP4\nMP3\nPDF\nDOC(X)\nXLS(X)\nTXT\nИзображение\nВидео\nАудио\nДокумент\nВажно!\nДа\nДа\nДа\nДа\nНет\nНет\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nСписок  рекомендованных  форматов,  указанный  в  таблице\n1,  не  является\nисчерпывающим.  У  каждого  мессенджера  есть  свой  список,  который  со  временем\nможет  изменяться.  Кроме  того,  необходимо  учитывать,  что  мессенджеры  имеют  свои\nособенности отображения медиа-контента (например, Viber в некоторых случаях не\nпозволяет просматривать изображения в мессенджере).\n1  Отправка  возможна  для  всех  видов  контента.  При  этом,  для  всех  видов  контента,  кроме  изображений,\nотправляется только ссылка на него. Соответственно, клиент не сможет просматривать аудио, видео или\nдокумент  прямо  в  мессенджере  (для  этого  нужно  будет  воспользоваться  браузером  или  другим\nприложением.\n18\nВ  таблице  приведены  наиболее  универсальные форматы,  подходящие  для  отправки\nклиенту  в  большинство  мессенджеров.  Перед  запуском  рассылки  для  клиентов\nнеобходимо предварительно тестировать рассылки на всех мессенджерах.\nДополнительно  нужно  учитывать,  что  для  некоторых  мессенджеров  важно,  чтобы\nистинный  формат  файла  соответствовал  его  расширению  (т. е.  чтобы  изображение\nimage.png действительно имело содержимое, предусмотренное форматом PNG, а не,\nнапример, данные в формате JPEG).\nДля добавления медиа-контента необходимо в блоке действий нажать на кнопку\nв раскрывшемся меню выбрать пункт «Добавить медиа» (см. Рисунок 21).\nи\nРисунок 21 — Переход к добавлению медиа-контента\nЗатем нужно задать тип медиа-контента и ввести ссылку (URL) на него, либо загрузить\nс компьютера при помощи кнопки\n(см. Рисунок 22).\nРисунок 22 — Добавление медиа-контента\n3.  Медиа группа — изображения и видео, которые могут быть добавлены к сообщению\nгруппой.\nВ  отличии  от  предыдущего  пункта,  медиа  группа  позволяет  отправлять  клиенту\nзаранее не определенное количество изображений и видео. Это удобно, например,\nдля  информирования  клиентов  о  результате  проведенных  работ,  когда  одному\n19\nклиенту  нужно  отправить  10  фотографий,  а  другому  15.  С  помощью  медиа  групп  это\nможно сделать одной рассылкой2.\nВторое отличие от одиночных медиа состоит в том, что с медиа группа отправляются\nклиенту  одним  сообщением3,  тогда  как  одиночные  медиа  отправляются  каждое  в\nотдельном сообщении.\nВ  группах  могут  отправляться  только  изображения  и  видео,  документы  и  аудио\nотправляться не могут.\nДля  добавления  группы  необходимо  в  блоке  действий  нажать  на  кнопку\nраскрывшемся меню выбрать пункт «Добавить медиа группу» (см. Рисунок 23).\nи  в\nРисунок 23 — Добавление медиа группы\nВ  открывшемся  окне  можно  добавлять  и  редактировать  ссылки  на  файлы,  которые\nбудут отправляться вместе с указанным сообщением (Рисунок 24).\nРисунок 24 — Редактор медиа групп\n2  Для  реализации  этого  сценария  необходимо  использовать  макросы,  см.  в  разделе  «Использование\nмакросов»\n3  Возможности просмотра одиночных и групп медиа («карусель», предпросмотр в виде плиток и т.д.) зависят\nот мессенджера.\n20\nВ  поле  URL  можно  вставить  как  сам  URL  изображения,  так  и  макрос  (подробнее  о\nмакросах в разделе «Использование макросов»).\nДля  загрузки  файлов  с  устройства  используется  кнопка\n.  Для  клонирования\nэлементов  –\nпоявившемся списке выбрать тип: изображение, видео или макрос.\n.  Для  выбора  типа  файла  необходимо  нажать  на  иконку\nи  в\nЗагруженные элементы отображаются справа. В правой области элементы можно как\nудалять  при  наведении  мышки  и  нажатии  на  кнопку  корзины,  так  и  перемещать  –\nкликнув мышкой на элемент и перетянуть в нужное место см. Рисунок 25.\nВ  левой  области\nтакже  можно  перетаскивать  элементы  и  менять  их\nпоследовательность.  Для  этого  необходимо  кликнуть  мышкой  на  элемент\nперетащить его в нужное место.\nи\nРисунок 25 — Взаимодействие с элементами в правой панели\nВажно!\nМаксимальное количество элементов в медиа группе равно 50. К одному текстовому\nсообщению может быть присоединена только одна медиа группа.\nВо всех полях медиа группы можно использовать макросы.\nРассмотрим случай, когда рассылка с медиа группой будет отправляться клиентам\nпо событию.  Ссылки на изображения мы хотим задавать динамически, в аргументах\nсобытия,  чтобы  мы  могли  отправить  одному  клиенту  11  фотографий,  а  другому  20  из\nодной рассылки. Для этого необходимо:\n1.  Создать  событие,  у  которого  будет  30  аргументов  (это  будет  максимальное\nчисло изображений в медиа группе в этом примере) (Рисунок 26);\n21\nРисунок 26 — Создание события для отправки изображений в медиа группе\n2.  Создать рассылку и настроить ее на начало по этому событию;\n3.  В конструкторе рассылки в блок добавить медиа группу;\n4.  В  медиа  группу  добавить  то  же  самое  количество  URL,  что  и  в  аргументах\nсобытия (см. Рисунок 27);\nРисунок 27 — Использование макросов с изображениями\n5.  В поле URL ввести аргументы события в фигурных скобках, указав в каждом поле\nтолько один аргумент, тип файла оставить как изображение (см. Рисунок 27);\n6.  Сохранить медиа группу.\n22\nПосле этого необходимо сгенерировать событие и в аргументах события указать\nссылки на файлы для отправки клиенту в мессенджер см. Рисунок 28.\nРисунок 28 — Генерация события с аргументами\nЕсли рассылка должна отправлять не только изображения в медиа группе, но и видео,\nтогда в макросах нужно передавать еще и тип медиа. Для этого в аргументах события\nнеобходимо  создать  в  два  раза  больше  аргументов,  чтобы  для  каждого  URL\nпередавался еще и тип, например см. Рисунок 29:\nРисунок 29 — Создания аргументов события для медиа группы\nВ настройках медиа группы для каждого URL выбираем тип \"Макрос\" и задаем URL и\nего тип макросами, как показано на Рисунок 30.\n23\nРисунок 30 — Создания медиа группы с разными типами\nПосле этого необходимо сгенерировать событие и в аргументах события указать\nссылки на файлы и типы для отправки клиенту в мессенджер, например, см. Рисунок\n31.\nРисунок 31 — Генерация события для медиа группы с типами медиа\n4.  Кнопки-действия — это кнопки, позволяющие выполнять следующие действия:\n•  Вызвать другой блок действий;\n•  Добавить клиенту теги;\n•  Снять теги с клиента;\n•  Отписать клиента от рассылок (всех)4.\nДля добавления кнопки-действия необходимо в блоке действий нажать на кнопку\nи в раскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 32).\n4 Действие эквивалентно тому, что клиент напишет боту команды «стоп рассылки» или «stop subscriptions»,\nсм. раздел Отписка от рассылок.\n24\nРисунок 32 — Переход к добавлению кнопки-действия\nЗатем  нужно  задать  требуемые  параметры  кнопки  и  нажать  на  кнопку  «Сохранить»\n(см.  Рисунок  33).  Для  каждой  кнопки  можно  указать  теги,  которые  будут  назначены\nклиенту (сняты с клиента), подробнее об этом см. в подразделе Работа с тегами.\nРисунок 33 — Добавление кнопки-действия\nПримечание:\nДлина заголовка кнопки должна быть не более 20 символов.\nДействия  в  блоке,  связанном  с  кнопкой,  всегда  выполняются  сразу  после  нажатия\nкнопки.  (см.  Рисунок  34).  Блок,  вызываемый  кнопкой-действием,  может  содержать\nлюбое из действий, описанных в разделе Блоки действий.\n25\nРисунок 34 — Второй блок выполняется сразу при нажатии на кнопку\nНа  одну  кнопку  клиент  может  нажать  только  один  раз.  Повторные  нажатия  не\nобрабатываются.  Если  сценарий  рассылки  предусматривает  возврат  к  блоку,\nкоторый клиент уже получал, то на кнопку можно будет нажать еще раз (см.  Рисунок\n35). В этом примере при нажатии на кнопку «Назад» клиент получит первый блок еще\nраз и именно в нем можно будет еще раз нажать на кнопку «Подробнее».\nРисунок 35 — Пример возврата\nПри  добавлении  к  сообщению  более  двух  кнопок-действий  появляется  опция\n«Разрешить только одно нажатие» (см. Рисунок 36).\nЕсли  она  установлена,  то  клиент  может  нажать  только  на  одну  кнопку  в  этом\nсообщении.  После  первого  нажатия  аналогичные  нажатия  по  другим  кнопкам  не\nобрабатываются.  Если  опция  не  установлена,  то  на  каждую  кнопку  в  сообщении\nможно нажать один раз.\n26\nРисунок 36 — В блок добавлено две кнопки-действия\nВажно!\nОписанное выше относится только к кнопкам сообщения, а не блока. В один блок может\nбыть добавлено несколько сообщений, каждое из которых будет содержать по нескольку\nкнопок. В этом случае при включенной опции «Разрешить только одно нажатие» в каждом\nсообщении можно будет нажать по одной кнопке.\nВ некоторых мессенджерах текст сообщений с кнопками может обрезаться. Т.е. клиент\nувидит  не  весь  отправленный  ботом  текст,  а  только  первые  несколько  символов.\nПредупреждение об этом всплывет справа у окна с текстом см. Рисунок 37. Например, в\nмобильной  версии  Viber  будет  отображаться  только  первые  40  символов  сообщения  с\nкнопкой, а в десктопной версии – первые 10.\nРисунок 37 - Текст с кнопкой, который обрежется в некоторых мессенджерах\nЧтобы  обойти  эту  проблему  рекомендуем  добавлять  отдельное  сообщение  перед\nсообщением с кнопкой и задавать в нем основной текст, а в сообщении с кнопкой писать\nчто-то короткое см. Рисунок 38.\n27\nРисунок 38 - Добавлено отдельное сообщение\n5.  Кнопки-ссылки  —  кнопки,  позволяющие  клиенту  перейти  по  заданной  ссылке  из\nмессенджера.\nДля добавления кнопки-ссылки необходимо в блоке действий нажать на кнопку\nраскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 39).\nи в\nРисунок 39 — Переход к добавлению кнопки-ссылки\nЗатем необходимо задать название кнопки и ссылку для нее (см. Рисунок 40).\nРисунок 40 — Создание кнопки-ссылки\n28\nСсылка  клиенту  не  отображается.  Нажатия  на  кнопку-ссылку  не  могут  приводить  к\nзапуску  другого  блока  или  иным  действиям,  а  также  никак  не  учитываются  в\nстатистике.\nПримечание:\nКлиент  может  нажимать  на  ссылки  многократно,  описанные  выше  ограничения  по\nнажатиям на них не действуют.\nОтправка сообщения, содержащего конфиденциальные данные для клиента\nВ  общем случае  вся  переписка клиента  с  ботом доступна  оператору  Maxbot. Если  бот\n(например,  кодов\nиспользуется  для  отправки  конфиденциальной  информации\nподтверждения), то такую информацию необходимо скрывать от оператора.\nДля  отправки  конфиденциальной  информации  в  теле  блока  с сообщением  необходимо\nиспользовать  тег  <security>…</security>  (см  Рисунок  41).  Вставка  закрывающего  тега\nобязательна.\nРисунок 41 — Отправка конфиденциальной информации при помощи тега <security></security>\nДанные, заключенные в теге <security>, для оператора заменяются на ***. То, что увидят\nклиент и оператор при запуске такой рассылки, показано на рисунке ниже:\nРисунок 42 — Отображение содержимого тега <security> для клиента и для оператора\nНа  практике  использование  тега  <security>  будет  сопровождаться  использованием\nмакроса,  т. е.  конфиденциальная  информация  вряд  ли  будет  задаваться  в  рассылке\nстатически.  В  этом  случае  тег  <security>  нужно  использовать  следующим  образом  (см.\nРисунок 43), поместив внутрь макрос, который является аргументом события:\n29\nРисунок 43 — Использование значения макроса в качестве конфиденциальной информации\nПеревод в канал\nДействие перевода в канал выполняется сразу, если диалог у клиента закрыт или диалог\nсвободный5  или  иное  на  задано  в  настройках  действия  (см.  далее).  При  наличии\nоткрытого диалога перевод выполнен не будет, чтобы не помешать текущему общению\nклиента  с  оператором.  Перевод  будет  отложен  до  тех  пор,  пока  диалог  у  клиента  не\nбудет закрыт или не будут выполнены условия, заданные в настройках действия.\nДля добавления действия перевода в канал нужно нажать на кнопку\nи в раскрывшемся\nменю  выбрать  пункт  «Действие»,  после чего  выбрать  «Перевести  в  канал»  (см.  Рисунок\n44):\nРисунок 44 — Выбор действия\nЗатем в открывшемся окне (см. Рисунок 45) необходимо задать параметры для действия\nперевода в канал.\nВ окне доступны следующие настройки:\n•  Выберите канал — канал, в который необходимо перевести клиента;\n5 Свободный диалог — диалог, у которого канал Bot.\n30\n•  Текст  при  переводе  в  канал  —  сообщение,  которое  будет  отправлено  клиенту  при\nпереводе в канал (если оставить его пустым, то сообщение не будет отправляться);\n•  Текст  при  откладывании  перевода  в  канал  —  сообщение,  которое  будет  оправлено\nклиенту,  если  в  момент  выполнения  действия  у  него  есть  открытый  диалог  и  он  не\nсвободный (т. е. клиент обсуждает с оператором или ботом какой-то вопрос);\n•  Текст перед отложенным переводом в канал — сообщение, которое будет отправлено\nклиенту при переводе в канал, если он ранее был отложен;\n•  Переключатель условия перевода в канал:\n•  Перевести сразу (значение по умолчанию) — клиент будет переведен в канал без\n(кроме  наличия  открытого/свободного\nкаких-либо  дополнительных  условий\nдиалога);\n•  Перевести  после  получения  сообщения  от  клиента  —  клиент  будет  переведен\nтолько  после  получения  от  него  сообщения  и  в  соответствии  с  настройками,\nуказанными ниже;\nРисунок 45 — Настройка действия перевода в канал\n31\n•  Время ожидания сообщения — время, которое бот ожидает сообщения от клиента для\nперевода  его  в  канал.  Можно  установить  время  не  более  2  часов  (ограничение\nвведено,  чтобы  маркетолог  не  мог  надолго  «блокировать»  клиента:  поскольку  в\nмомент ожидания не могут выполняться другие рассылки, а также клиенту не смогут\nотправлять сообщения операторы);\n•  Если  клиент  не  ответил  за  заданное  время  —  действие,  которое  бот  выполнит,  не\nдождавшись сообщения от клиента в течение «времени ожидания сообщения»:\n•  «Ничего не делать» — бот не будет предпринимать каких-либо действий; клиент не\nбудет переведен в канал, рассылка при этом продолжится согласно сценарию;\n•  «Перевести  в  канал  безусловно»  —  клиент  будет  переведен  в  канал,  при  этом\nможно задать другой канал (отличный от исходно заданного);\n•  «Отправить сообщение» — клиенту будет отправлено сообщение, заданное в поле\nниже; клиент не будет переведен в канал.\nЕсли для рассылки ниже (см. Рисунок 46) задать безусловный перевод клиента в канал по\nфакту  нажатия  на  кнопку  «Оставить  отзыв»,  то  клиент  будет  переведен  сразу,  какого-\nлибо сообщения от него не требуется.\nРисунок 46 — Пример рассылки с переводом в канал\nВ  этом  случае  оператор  увидит  нового  клиента  в  списке  диалогов,  но  сообщение  от\nклиента будет отсутствовать (см. Рисунок 47).\nРисунок 47 — Клиент переведен в канал без сообщения\n32\nЕсли  же  в  настройках  перевода  в  канал  потребовать  ввод  сообщения  от  клиента  (см.\nРисунок 48), то новый диалог появится только после отправки клиентом сообщения.\nРисунок 48 — Ввод условия перевода клиента в канал только при наличии от него сообщения\nВ этом случае оператор уже сразу увидит текст сообщения и не будет тратить время на\nвыяснение причины и содержания обращения (см. Рисунок 49).\nРисунок 49 — Клиент переведен в канал после отправки им сообщения\nОтмена отправки запланированных сообщений\nЭто  действие  позволяет  маркетологу  остановить  рассылку  для  клиента  при\nвозникновении  некоторого  события.  Например,  при  нажатии  кнопки,  при  отправке\nфинального сообщения рассылки, при истечении определенного времени.\nДля  добавления  действия  нужно  нажать  на  кнопку\nи  в  раскрывшемся  меню  выбрать\nпункт «Действие», после чего выбрать «Отключить рассылку запланированных, но еще не\nотправленных сообщений» (см. Рисунок 50):\n33\nРисунок 50 — Выбор действия\nНа  рисунке  51  показан  пример  такого  сценария.  Если  клиент  нажмет  на  кнопку  «Не\nинтересуюсь  этим»,  робот  отправит  извинительное  сообщение  и  отключит  отправку\nзапланированных сообщений. В данном случае это правое нижнее сообщение, которое\nпредполагалось отправить через 5 дней.\nЕсли  клиент  в  течение  5  дней  не  нажмет  эту  кнопку,  то  он  получит  запланированное\nсообщение с информацией о продлении акции.\nРисунок 51 — Пример использования события отмены отправки запланированных сообщений\nВажно!\nДействие отмены отправки запланированных сообщений применяется ко всей рассылке\nдля текущего клиента, независимо от того, из какой ветви сценария оно было вызвано.\n34\nОтмена работы уже отправленных в рассылку кнопок\nЭто  действие  работает  аналогично  предыдущему,  только  отменяет  не  отправку\nсообщений, а работу кнопок в сообщениях. Вместе с предыдущим действием позволяет\nполностью деактивировать рассылку для клиентов, у которых они будут выполнены.\nи  в  раскрывшемся  меню  выбрать\nДля  добавления  действия  нужно  нажать  на  кнопку\nпункт «Действие», после чего выбрать «Отключить работу уже отправленных в рассылку\nкнопок» (см. Рисунок 52):\nРисунок 52 — Выбор действия\nВ следующем сценарии (см. Рисунок 53) при нажатии на кнопку «Не интересуюсь этим»\nпроизойдет не только отмена запланированного сообщения, но и перестанет работать\nкнопка, отправленная клиенту в первом сообщении.\nРисунок 53 — Использование действия отмены работы уже отправленных в рассылку кнопок\n35\nВажно!\nЭто  действие  отменяет  только  работу  кнопок-действий.  Кнопки-ссылки  будут  всегда\nдоступны, клиенты смогут переходить по ним произвольное число раз.\nДействие  отмены  работы  кнопок  применяется  ко  всей  рассылке  для  текущего  клиента,\nнезависимо от того, из какой ветви сценария оно было вызвано.\nВызов внешней системы\nДействие  «Вызвать  внешнюю  систему»  предназначено  для  уведомления  внешней\nсистемы о достижении клиентом того или иного этапа рассылки.\nи в раскрывшемся\nДля добавления вызова внешней системы нужно нажать на кнопку\nменю  выбрать  пункт  «Действие»,  после  чего  выбрать  «Вызвать  внешнюю  систему»  (см.\nРисунок 54).\nРисунок 54 — Выбор действия\nДалее необходимо задать параметры запроса к внешней системе. Для примера далее\nзаполнено  обращение  к  CRM  компании  для  того,  чтобы  отметить  интерес  клиента  к\nопределенной  теме  в  случае  нажатия  на  определенную  кнопку  (см.  Рисунок  55).  В\nдальнейшем в CRM это можно будет использовать для сегментации аудитории.\nПример  ниже  отражает  вариант  запроса,  при  выполнении  которого  в  CRM  компании\nсохраняются данные о том, что клиент с идентификатором 12443 интересуется товарами\nв категории «наушники» (headphones).\nКроме  строковых  и  числовых  параметров  также  могут  использоваться  макросы,  см.\nподробнее в разделе Использование макросов.\n36\nРисунок 55 — Ввод параметров запроса к внешней системе\nЕсли в блоке есть действие вызова внешней системы, то оно всегда выполняется первым.\nЕсли вызов завершается ошибкой (сервер возвращает HTTP-статус, отличный от 200 или\nне  отвечает  в  течение  времени,  заданного  в  поле  «Максимальное  время  выполнения\nзапроса»), то остальные действия блока не выполняются. Если к текущем блоку привязаны\nпоследующие блоки (т. е. выполняются после отправки сообщения из этого блока), то они\nтакже не будут выполнены.\nПримечание:\nВ текущей версии «Максимальное время выполнения запроса» и все подобные таймауты\nвременно равны 0.5 секунды вне зависимости от заданного значения.\nГенерация события\nБлок  этого  типа  позволяет  вызывать  события  и  использовать  их  для  запуска  других\nрассылок из текущей рассылки.\nЕсли клиент по сценарию рассылки перейдет к действию «Сгенерировать событие», то\nэто  событие  будет  сгенерировано  либо  только  для  него;  если  для  события  задана\nфиксированная  аудитория  (см.  подробнее  в  разделе  Определение  аудитории),  то\nсобытие  будет  сгенерировано  для  нее  (будет  запущена  рассылка  для  множества\n37\nклиентов). Это позволит начать одну или несколько других рассылок. Текущая рассылка\nпри этом не будет остановлена, ее сценарий продолжит выполняться.\nРисунок 56 — Выбор действия «Сгенерировать событие\nНапример,  есть  рассылка,  предлагающая  клиенту  воспользоваться  промокодом  (см.\nРисунок 57). Если клиент нажимает на кнопку, то во втором блоке рассылки генерируется\nсобытие «Создание промокода для клиента».\nПримечание:\nСобытие,  используемое  в  сценарии  рассылки,  должно  быть  предварительно  создано.\nПодробнее об этом см. в разделе Использование событий.\nРисунок 57 — Рассылка, в сценарии которой генерируется событие для клиента\nВ аргументах события, генерируемого для клиента, нужно задать требуемые значения. В\nнашем случае нужно задать значения для 3-х аргументов (см. Рисунок 58):\n•  промокод — строка;\n38\n•  размер скидки (%) — число;\n•  действует до — строка.\nРисунок 58 — Событие «Создание промокода для клиента» и его аргументы\nПример ввода значений аргументов события показан на рисунке 59.\nПри  указании  строковых  значений  необходимо  использовать  символ  кавычек  (“);\nчисловые значения и даты задаются без кавычек. Значение аргумента также может быть\nпустым (не задано).\nПри этом могут быть заданы как статические значения аргументов (в примере выше), так\nи динамические — макросы, уникальные для каждого клиента.\nПереключатель  под  названием  события  определяет,  для  кого  будет  сгенерировано\nсобытие:\n•  только для текущего клиента\nили\n•  для множества клиентов (для рассылок с фиксированной аудиторией).\n39\nРисунок 59 — Ввод аргументов для события\nТеперь  можно  создать  вторую  рассылку,  которая  будет  выполняться  при  генерации\nсобытия в первой рассылке. Ниже пример такой рассылки (см. Рисунок 60):\nРисунок 60 — Вторая рассылка, запускаемая по сгенерированному событию и использующая\nзначения аргументов события\nПримечание:\nЕсли  рассылка  запускается  по  событию,  то  его  аргументы  можно  использовать  в\nрассылке  как макросы.  На  рисунке  выше  во  второй  рассылке  при  помощи  скобок  {{  }}\nиспользуются значения аргументов сгенерированного события.\nДля данной рассылки нужно выбрать условие «Начинать при возникновении события» и\nсобытие  «Создание  промокода  для  клиента»  (см.  Рисунок  61),  после  чего  запустить  ее.\nРассылка будет «ожидать» выбранного события и выполнится у клиентов, для которых оно\nнаступило.\n40\nРисунок 61 — Определение условий начала второй рассылки\nЕсли  в  результате  выполнения  первой  рассылки  (см.  Рисунок  57)  клиент  нажмет  кнопку\n«Получить  промокод»,  то  в  результате  выполнения  второй  рассылки  будут  получены\nданные промокода (см. Рисунок 62).\nРисунок 62 — После нажатия на кнопку «Получить промокод» для клиента выполнилась вторая\nрассылка\nГенерация интента\nБлок  этого  типа  позволяет  сгенерировать  интент  (intent)  —  намерения  пользователя,\nкоторые могут быть распознаны системой для того, чтобы затем вызвать определенный\nнавык бота.\n41\nДля вызова навыков бота необходимо:\n1.  Нажать  на  кнопку\nи  в  раскрывшемся меню  выбрать  пункт «Действие»,  после  чего\nвыбрать «Сгенерировать intent» (см. Рисунок 63).\nРисунок 63 — Выбор действия «Сгенерировать intent»\n2.  В  настройках  действия  (см.  Рисунок  64)  задать  название  интента  и  (необязательно)\nсловарь сущностей (entities). Важно, что в поле «Entities» должен быть задан именно\nсловарь в формате JSON (как на рисунке ниже), иначе выполнение сценария рассылки\nзавершится ошибкой.\nВ словаре могут быть использованы как макросы и переменные окружения (в нотации\n«slots.m.macros_name»),  так  и  статические  значения.  Этот  словарь  должен  быть\nвалидным jinja-выражением.\nКонстантные выражения также нужно задавать правильно — строки только в кавычках,\nчисла — без, и они не должны оставаться пустыми.\nРисунок 64 — Ввод параметров интента\n42\n3.  Нажать на кнопку «Сохранить».\nВ результате выполнения этого действия бот сгенерирует указанный интент и передаст\nslots  в  качестве  параметров.  Это  позволит  запустить  нужный  навык  бота  для  клиента\n(например, выбор определенного товара или услуги).\nПримечание:\nЧтобы бот выполнил определенное действие, навыки бота должны быть предварительно\nнастроены.\nВ перспективе это действие должно вытеснить большинство переводов в канал – вместо\nтого,  чтобы  передавать  клиента  оператору  и  занимать  его  время,  рассылка  будет\nвызывать соответствующий навык бота.",
      "tags": [
        "аргумент",
        "блок",
        "диалог",
        "идентификатор",
        "макрос",
        "мессенджер",
        "настройк",
        "ограничен",
        "ошибк",
        "рассылк",
        "событ",
        "тег",
        "тест",
        "тип"
      ]
    },
    {
      "section_id": "26_настройка_условий_начала_рассылки",
      "section_title": "Настройка условий начала рассылки",
      "level": 0,
      "page_start": 48,
      "page_end": 60,
      "text": "Настройка условий начала рассылки\nНастройки,  задаваемые  на  вкладке  «Условия  начала  рассылки»,  определяют  правила\nзапуска для клиентов из аудитории рассылки. Эти настройки можно разделить на четыре\nчасти (см. Рисунок 75):\n•  Условия начала рассылки для клиентов (1);\n•  Время, после которого рассылка не начнется для клиента (2);\n•  Время, когда никакие действия рассылки не выполняются для клиента (3);\n•  Расширенные настройки (4).\n48\nРисунок 75 — Настройки условий начала рассылки\nВажно отметить, что условия начала задаются до первого запуска рассылки в состоянии\n«Не  запущена»  (см.  подробнее  в  разделе  Возможные  состояния  рассылки).  После\nзапуска рассылки изменить условия начала нельзя. Это касается следующих изменений:\n•  изменение условия начала рассылки (т. е., например, перехода от тега к событию),\n•  изменение тега или события, которые начинают рассылку,\n•  изменение времени, в которое начнется рассылка (для рассылок с фиксированной\nаудиторией, которые начинаются в заданное время);\n•  изменение времени, после которого рассылка не начнется для клиента.\nЕсли нужно изменить эти параметры, следует клонировать рассылку и внести изменения\nдо запуска рассылки, см. подробнее в разделе Изменение условий начала и аудитории\nдля запущенной рассылки.\nУсловия начала\nНачать сразу после запуска рассылки\nПри  выборе  этой  настройки  рассылка  начинает  выполняться  для  всех  клиентов  из\nаудитории  рассылки  сразу  после  ее  запуска.  Аудитория  рассылки  фиксирована\n(задается до запуска рассылки) и не может быть изменена до остановки рассылки.\nПосле  того,  как  рассылка  начнется  для  всех  клиентов  она  автоматически  переходит  в\nпассивный режим. В этом состоянии продолжается выполнение сценария рассылки для\nклиентов.\n49\nНачинать в заданное время\nПри выборе этой настройки рассылка стартует для всех клиентов из аудитории рассылки\nв заданное маркетологом время.\nПрочие условия аналогичны предыдущей опции.\nНачинать в заданное время и отправлять равномерно\nЭта  настройка  позволяет  автоматически разделить  аудиторию  и  отправлять рассылки\nодинаковыми «порциями». Это может быть полезно, например, чтобы сделать нагрузку на\nоператоров, принимающих заявки от клиентов из рассылки, более-менее равномерной.\nКак  и  в  двух  предыдущих  случаях  аудитория  рассылки  фиксирована  и  задается  до  ее\nзапуска.\nСхема работы рассылки при выборе данной опции следующая: все клиенты аудитории\nразделяются  на  подгруппы  заданного  размера,  например,  по  500  человек.  Рассылка\nначинается  не  для  всех  клиентов  из  аудитории  сразу,  как  для  предыдущих  двух\nвариантов, а только для клиентов одной подгруппы. Далее бот ждет заданное время, и\nначинает рассылку для следующей подгруппы клиентов. При этом рассылка начинается\nдля подгрупп клиентов только в заданное время, например, «вторник-четверг с 11 до 16».\nВ остальное время рассылка не начинается.\nПри выборе этой настройки отображаются дополнительные опции (см. Рисунок 76):\n•  Даты начала и окончания — определяют время, когда рассылка начнется6 для первой\n«порции»  клиентов  и  когда  она  перестанет  начинаться.  Иными  словами,  если  для\nкакого-то  клиента  из  аудитории  рассылки  первый  блок  рассылки  не  успеет\nвыполниться в заданный промежуток времени, то рассылка для этого клиента уже не\nначнется;\n•  Две  группы  с  одинаковыми  настройками,  определяющих,  как  рассылка  должна\nпроводиться в рабочие и в выходные дни.\nВ каждой группе задаются следующие параметры:\n•  «Часы  работы»  —  часы,  в  которые  рассылка  будет  пытаться  начаться  для\nочередной подгруппы клиентов;\n•  «Отправлять каждые» — интервал, через который рассылка будет начинаться для\nследующей группы клиентов;\n•  «Максимальное количество клиентов за одну отправку» — размер группы клиентов,\nдля  которых  рассылка  будет  начинаться  через  каждый  заданный  интервал\nвремени.\n6 Подробнее о режимах (состояниях) рассылки см. в разделе Возможные состояния рассылки.\n50\nПримечание:\nОдну из групп настроек можно полностью выключить, сняв флажок рядом с названием.\nВ этом случае она применяться не будет.\nНапример, с настройками как на рисунке далее рассылка будет начинаться каждые 10\nминут для очередных 100 клиентов из множества всех клиентов аудитории рассылки.\nРисунок 76 — Ввод дополнительных настроек для условия «Начинать в заданное время и\nотправлять равномерно»\nВажно!\nДни и часы, заданные в настройках равномерной рассылки, могут противоречить дням и\nчасам,  заданным  в  группе  Время,  когда  запланированные  действия  рассылки  не\nвыполняются. В этом случае приоритет имеют настройки исключения времени. Т. е. если\n51\nодин  и  тот  же  день  задан  в  настройках  равномерной  рассылки  и  в  настройках\nисключения, то рассылка в этот день начинаться не будет.\nКроме  того,  нужно  учитывать,  что  настройка  времени  равномерной  рассылки\nприменяется  в  часовом  поясе  компании,  а  настройка  исключения  по  времени  —  в\nчасовом поясе клиента.\nНачинать в заданное время и отправлять равномерно (аудитория из внешней системы)\nПри  выборе  этого  варианта,  как  и  в  предыдущем  случае,  рассылка  начинается  для\nклиентов  равномерно,  одинаковыми  «порциями»  через  заданный  период  времени.\nНапример,  можно  начинать  рассылку  для  очередных  100  клиентов  через  каждые  два\nчаса.  Отличие  от  предыдущего  случая  состоит  в  источнике клиентов.  В  данном  случае\nсписок клиентов, для которых начнется рассылка, загружается динамически из внешнего\nREST-сервиса  при  каждой  попытке  начать  рассылку,  а  не  из  файла как  в  предыдущем\nслучае.\nДля примера рассмотрим рассылку с настройками как на рисунке ниже:\nРисунок 77 – Основные настройки равномерной рассылки с аудиторией из внешней системы\nПосле запуска такой рассылки Marketer будет каждые 40 минут запрашивать па адресу\n«http://example.com/api/v1/customers»  список  из  200  клиентов  в  определенном\nформате (описан ниже). После проверки полученных данных рассылка начнется для этих\nклиентов.  То  же  самое  произойдет  еще  через  40  минут  и  так  далее  в  зависимости  от\nдругих настроек рассылки, которые позволяют ограничить эти запросы по времени. При\nэтом если сервер повторно отдаст клиента, для которого эта рассылка уже началась, то\nрассылка не начнется для него повторно. Все клиенты, для которых рассылка успешно\nначалась, будут отображаться на вкладке «Целевая аудитория».\nНастройки  рассылки  в  этом  случае  полностью  совпадают  с  настройками  обычной\nравномерной  рассылки  для  фиксированной  аудитории,  описанной  в  предыдущем\nразделе. Так же задаются часы работы в рабочие и выходные дни, общие ограничения\nпо времени работы и лимиты на количество клиентов. Подробнее это описано в разделе\n«Начинать в заданное время и отправлять равномерно».\n52\nФормат данных списка клиентов\nMarketer  выполняет  GET  запрос  по  указанному  в  поле  «URL  для  получения  аудитории»\nадресу и добавляет к нему параметр limit, в котором указывает максимальное количество\nклиентов.\nВнешний  REST-сервис  должен  отдавать  список  клиентов  в  формате,  описанном  в\nразделе «Формат файлов JSON» ниже.\nПри  этом  количество  клиентов  не  должно  превышать  значение,  заданное  в  параметре\nlimit (но может быть меньше). Это значение устанавливается маркетологом при настройке\nрассылки в полях «Максимальное количество клиентов за одну отправку» для выходных\nи  рабочих  дней  отдельно.  Если  внешний  REST-сервис  вернет  больше  клиентов,  чем\nзадано  в  limit,  то  будет  сгенерирована  ошибка,  рассылка  не  отправится  ни  одному\nклиенту.  Через  заданное  в  настройках  рассылки  время  будет  выполнен  следующий\nзапрос, будут выполняться те же проверки и т.д.\nНапример, в рассылке с настройками как на рисунке выше указан «URL для получения\nаудитории»\nhttp://example.com/api/v1/customers\nи «Максимальное количество клиентов за одну отправку» 200. Каждые 40 минут Marketer\nбудет выполнять запрос\nGET http://example.com/api/v1/customers?limit=200\nи этот REST-сервис должен возвращать JSON вида\n{\n\"customers\": [\n{\n\"id\": 123456,\n\"timezone\": \"Europe/Moscow\",\n\"failback_to_sms\": true,\n\"customer_data\": {\n\"first_name\": \"Gregory\"\n}\n}\n],\n\"macroses\": [\n\"name\": \"first_name\",\n\"type\": \"string\"\n{\n}\n]\n}\nВ данном случае в списке указан один клиент и рассылка начнется только для него.\n53\nЕсли  сервер  требует  авторизацию,  то  токен  может  быть  задан  в  поле  «Bearer\nавторизация»,\nРисунок 78 – параметры авторизации внешнего REST-сервиса\nВ таком случае Marketer будет выполнять запрос с HTTP-заголовком\nAuthorization: Bearer abcdefghijklmnopqrstuvwxyz\nТестирование запросов\nДля  проверки  работы  внешнего  REST-сервиса  можно  воспользоваться  кнопкой\n«Выполнить  тестовый  вызов».  Marketer  выполнит  GET  запрос  по  указанному  URL  с\nпараметрами, указанными в настройках, и частично произведет валидацию полученных\nданных.\nЕсли данные будут получены успешно и будут удовлетворять формату, описанному выше\n(см. Формат данных списка клиентов), то результат будет как на рисунке ниже:\nРисунок 79 – Успешное выполнение тестового запроса на загрузку аудитории рассылки\n54\nЕсли  Marketer  не  сможет  получить данные  по  заданному  URL, либо  их  формат  не  будет\nсоответствовать требуемому, то результат будет иметь такой вид:\nРисунок 80 – Выполнение тестового запроса завершилось ошибкой. Формат данных в ответе\nвнешнего REST-сервиса не соответствует требуемому.\nВажно!\nУспешное  выполнение  тестового  запроса  не  гарантирует  успешное  начало  рассылки\nдля клиентов при ее выполнении, т.к. некоторые проверки, например, полноты указанных\nмакросов для каждого клиента, происходят только в ходе выполнения рассылки.\nОтладка рассылок с аудиторией из внешней системы\nЕсли рассылка не начинается для клиентов в указанное время или начинается, но не для\nвсех,  можно  определить  причину  такого  поведения  системы.  Для  этого  необходимо\nскачать  журнал  запросов,  которые  выполнял  Marketer  к  внешнему  REST-сервису.  Это\nможно сделать в настройках рассылки на вкладке «Статистика»:\nРисунок 81 – Загрузка журнала запросов аудитории рассылки\nПри скачивании журнала можно применить фильтры по датам, чтобы исключить ненужные\nданные.\nРезультат представляет собой файл в формате JSON, который описывает все запросы,\nкоторые выполнял Marketer для загрузки аудитории, и результаты обработки полученных\nданных. Формат файла подробно описан ниже.\nЕсли информации о запросах за нужное время нет, это значит, что настройки рассылки\nзапрещают начинать ее в это время, или рассылка была в пассивном или отключенном\nсостоянии.\n55\nФормат файла с журналом запросов аудитории рассылки\nПоле\nurl\nresponse_json\nresponse_text\nОписание\nURL,  который  использовался  для  выполнения  запроса\nсписка клиентов.\nОтвет,  полученный  от сервера.  Задано,  только  если  в\nответе содержался валидный JSON.\nОтвет,  полученный  от  сервера.  Задано,  только  если\nответ сервера не является валидным JSON.\nmacroses\nСписок макросов, выделенных из ответа сервера.\nsuccess_customers\nduplicate_customers\nfailed_customers\nerror\nfirst_date\nlast_date\ncount\nСписок  клиентов,  для  которых  рассылка  должна\nуспешно начаться.\nСписок\nначиналась и повторно не начнется.\nклиентов,  для  которых  рассылка  уже\nСписок  клиентов,  данные  которых  не  прошли\nвалидацию. Например, не задан один из макросов или\nнет необходимых, согласно заданному формату, полей.\nСообщение об ошибке при выполнении запроса.\nДата запроса (или дата первого запроса в серии, если\ncount > 1)\nДата запроса (или дата последнего запроса в серии,\nесли count > 1)\nКоличество  запросов  в  серии  одинаковых  запросов.\nЕсли  значение  более  1,  то  это  означает,  что  между\nfirst_date  и  last_date  произошло  count  одинаковых\nошибок.  Смысл  в  том,  чтобы  не  засорять  журнал\nмножеством одинаковых записей.\nhistory_id\nИдентификатор записи в журнале.\nНачинать при получении ключевого слова\nВ этом случае рассылка начинается для тех клиентов, которые отправили боту одно из\nключевых  слов.  Ключевое  слово  должно  полностью  совпадать  с  одним  из  заданных  в\nнастройках  рассылки  текстов  (см.  Рисунок  82).  В  одну  рассылку  можно  добавить  до  10\nключевых слов.\nПодобные  рассылки  могут  использоваться  в  различных  маркетинговых  кампаниях.\nНапример, маркетолог в одной из соцсетей размещает рекламный пост с предложением\nполучить  скидку  на  товары  или  услуги.  Для  этого  клиент  должен  написать  боту\nопределенное слово или фразу, например, «ХочуСкидку». Если клиент отправляет такое\nсообщение, для него начинается рассылка – автоворонка продаж.\n56\nРисунок 82 — Настройка рассылки, которая начинается по ключевым словам\nПри проверке совпадения ключевых слов есть ряд важных особенностей:\n•  Регистр букв не учитывается. Например, если в настройках рассылки будет указано\nслово «ХочуСкидку», а клиент пришлет «хочускидку», то рассылка начнется;\n•  Пробельные  символы  до  и  после  слова/фразы  не  учитываются.  Например,  если  в\nнастройках  рассылки  будет  указано  слово  «ХочуСкидку»,  а  клиент  пришлет\n«  ХочуСкидку   », то рассылка начнется;\n•  Проверяется  совпадение  всего  сообщения  целиком.  Например,  если  в  настройках\nрассылки  будет  указано  слово  «ХочуСкидку»,  а  клиент  пришлет  «ХочуСкидку,\nпожалуйста», то рассылка не начнется;\n•  Минимальная длина ключевого слова – один символ. Например, можно использовать\nсмайлик –     .\nЕсть  ограничение, что  для  каждого  ключевого  слова  может  быть  запущена  (в  активном\nрежиме) только одна рассылка. То есть запуск двух рассылок с одним ключевым словом\nневозможен. Ограничений на существование рассылок в пассивном и других режимах,\nнастроенных на начало по одному ключевому слову, нет.\nЕще одним условием начала рассылки по ключевым словам, является состояние диалога,\nв котором клиент отправляет ключевое слово. Если клиент использует ключевое слово в\nпереписке с оператором (состояние диалога active7) или ботом (состояние диалога bot),\nто  рассылка  не  начнется.  Если  ключевое  слово  будет  использовано  при  ожидании  в\nканале (состояния диалога waiting), то рассылка начнется, но клиент будет уведомлен о\nтом, что ожидание в канале прервано и он вернулся к боту. Ниже представлена Таблица\n2, описывающая поведение бота при использовании ключевых слов в разных состояниях\nдиалога.\n7  Подробнее  состояния  диалогов  описаны  в  Руководстве  оператора  в  разделе  «Приложение  Б.  Статусы\nобработки обращений»\n57\nТаблица 2 — Состояние диалога во время начала рассылки по ключевым словам\nСостояние диалога\nwaiting\nclosed\nbot\nactive\nли\nМожет\nначаться\nрассылка  по  ключевым\nсловам?\n*\n* - При использовании ключевого слова обращение к оператору будет отклонено. Клиент\nбудет уведомлен об этом и перемещен в канал bot. После этого начнется рассылка по\nключевым словам.\nЧтобы рассылка больше не начиналась для клиентов, нужно либо задать дату с временем\nокончания рассылки, либо вручную остановить рассылку или перевести ее в пассивный\nрежим.\nНачинать при выставлении тега\nВ этом случае рассылка стартует для тех клиентов, которые после ее запуска получили\nодин из заданных тегов. Если тег уже был выставлен ранее, то рассылка не стартует.\nЕсли после запуска рассылки тег был выставлен дважды, т. е. сначала выставлен, потом\nудален, а затем снова выставлен, то рассылка может прийти клиенту дважды. Может  —\nпотому что есть другая опция, регулирующая это поведение, об этом далее в подразделе\nРасширенные настройки.\nЧтобы  прекратить  запуск  рассылок  для  клиентов,  которые  получают  заданные  теги,\nнужно  остановить  рассылку  или  перевести  ее  в  пассивный  режим,  либо  задать  дату  с\nвременем окончания рассылки.\nНачинать при возникновении события\nВ этом случае сценарий рассылки будет запущен  для тех клиентов, для которых после\nзапуска  рассылки  сгенерировано  внешнее  событие.  Например,  CRM  компании  может\nсгенерировать событие «Клиент совершил покупку». Информация об этом событии вместе\nс  дополнительными  аргументами  может  быть  передана  в  консоль  маркетолога,  и  для\nклиента может быть запущена специальная рассылка.\nПодробнее об этом описано в разделе Использование событий.\nЧтобы  прекратить  запуск  рассылок  для  клиентов,  для  которых  генерируются  события,\nнужно  остановить  рассылку  или  перевести  ее  в  пассивный  режим,  либо  задать  дату  с\nвременем окончания рассылки..\nНачинать при возникновении события для заданной аудитории\nВ  этом  случае  рассылка  стартует  при  возникновении  события,  но  не  для  заданного  в\nсобытии клиента, а для указанной в настройках рассылки целевой аудитории.\n58\nВремя, после которого рассылка не начнется для клиентов\nЭта  настройка  ограничивает  начало  рассылки  для  клиентов,  если  указанное  в\nнастройке  время  истекло.  Настройка  необходима  тогда,  когда  у  рассылки  есть\nограничение  в  актуальности  отправляемых  данных.  Например,  маркетолог  создает\nрассылку с акцией, которая действует до конца недели и запускает рассылку в начале\nнедели. У клиента в момент запуска рассылки может быть открыт диалог с оператором и\nдиалог  может  не  закрываться  до  конца  недели.    Если  описанная  настройка  не  будет\nиспользоваться, то клиент получит рассылку, когда акция уже закончится (т.к. рассылка\nбудет  отложена  до  завершения  диалога  с  оператором).  А  если  маркетолог  задаст\nограничение  по  времени,  то  такого  не  произойдет,  клиент  не  получит  неактуальную\nрассылку.\nРисунок 83 - Настройка ограничения времени запуска рассылки\nНастройку  можно  применить  при  любом  условии  начала  рассылки  и  новые  запуски\nрассылки прекратятся, даже если будет сгенерировано событие, или выставлен тег, или\nнаступят  другие  условия  начала  рассылки.    Это  позволяет  не  допустить  случайной\nотправки рассылки по событию или тегу после того, как рассылка потеряет актуальность.\nВажно!\nЕсли рассылка успеет начаться до установленного в настройке времени, т.е. для клиента\nвыполнится  хотя  бы  один  блок  рассылки,  то  она  будет  продолжаться  и  после  этого\nвремени. Кнопки будут работать, запланированные сообщения будут отправляться.\nПо умолчанию опция отключена, но для равномерных рассылок она присутствует всегда\nи называется по-другому: «Рассылка закончится для клиентов в» (см. Рисунок 84).\nРисунок 84 – Настройка времени окончания запусков для равномерных рассылок\n59\nВремя,  когда  запланированные  действия  рассылки  не\nвыполняются для клиента\nВ  этой  части  настроек  задаются  дни  недели  и  время,  в  которые  клиенту  не  будут\nотправляться  сообщения  и  выполняться  запланированные  действия  рассылки.  Если\nкакой-то шаг рассылки попадет на запрещенное время, то он будет отложен.\nНапример, если по сценарию рассылки клиент должен получить сообщение в 1 час ночи,\nто  отправка  сообщения  будет  отложена  до  9  утра  (при  настройках  запрещенного\nвремени по умолчанию, см. Рисунок 85).\nВремя, заданное в этой части настроек, рассчитывается в часовом поясе клиента. Т. е.\nрассылка  типа  «Начать  сразу  после  запуска  рассылки»,  запущенная  в  15:00  по\nмосковскому  времени,  не  придет  клиенту из  Владивостока сразу,  а  будет  отложена  до\n9:00 в его часовом поясе (при настройках запрещенного времени по умолчанию).\nРисунок 85 — Настройка запрещенного времени и дней недели для рассылок\nДля  информационных  рассылок  целесообразно  не  задавать  запрещенное  время,  т.  к.\nнекоторые  из  них,  например,  получение  секретных  кодов,  должны  работать  в  режиме\n24/7.\nРасширенные настройки\nДля рассылок, начинающихся по событию или тегу, группа расширенных настроек имеет\nследующий вид (см. Рисунок 86):\n60\nРисунок 86 — Расширенные настройки для рассылок, начинающихся по событию или по тегу\nДля  рассылок  с  фиксированной  аудиторией  группа  расширенных  настроек  имеет\nследующий вид (см. Рисунок 87):\nРисунок 87 — Расширенные настройки для рассылок с фиксированной аудиторией\nПримечание:\nПодробнее о типах аудитории см. в разделе",
      "tags": [
        "валидац",
        "диалог",
        "идентификатор",
        "макрос",
        "настройк",
        "ограничен",
        "ошибк",
        "рассылк",
        "событ",
        "тег",
        "тест"
      ]
    },
    {
      "section_id": "27_условия_начала",
      "section_title": "Условия начала",
      "level": 1,
      "page_start": 49,
      "page_end": 58,
      "text": "Условия начала\nНачать сразу после запуска рассылки\nПри  выборе  этой  настройки  рассылка  начинает  выполняться  для  всех  клиентов  из\nаудитории  рассылки  сразу  после  ее  запуска.  Аудитория  рассылки  фиксирована\n(задается до запуска рассылки) и не может быть изменена до остановки рассылки.\nПосле  того,  как  рассылка  начнется  для  всех  клиентов  она  автоматически  переходит  в\nпассивный режим. В этом состоянии продолжается выполнение сценария рассылки для\nклиентов.\n49\nНачинать в заданное время\nПри выборе этой настройки рассылка стартует для всех клиентов из аудитории рассылки\nв заданное маркетологом время.\nПрочие условия аналогичны предыдущей опции.\nНачинать в заданное время и отправлять равномерно\nЭта  настройка  позволяет  автоматически разделить  аудиторию  и  отправлять рассылки\nодинаковыми «порциями». Это может быть полезно, например, чтобы сделать нагрузку на\nоператоров, принимающих заявки от клиентов из рассылки, более-менее равномерной.\nКак  и  в  двух  предыдущих  случаях  аудитория  рассылки  фиксирована  и  задается  до  ее\nзапуска.\nСхема работы рассылки при выборе данной опции следующая: все клиенты аудитории\nразделяются  на  подгруппы  заданного  размера,  например,  по  500  человек.  Рассылка\nначинается  не  для  всех  клиентов  из  аудитории  сразу,  как  для  предыдущих  двух\nвариантов, а только для клиентов одной подгруппы. Далее бот ждет заданное время, и\nначинает рассылку для следующей подгруппы клиентов. При этом рассылка начинается\nдля подгрупп клиентов только в заданное время, например, «вторник-четверг с 11 до 16».\nВ остальное время рассылка не начинается.\nПри выборе этой настройки отображаются дополнительные опции (см. Рисунок 76):\n•  Даты начала и окончания — определяют время, когда рассылка начнется6 для первой\n«порции»  клиентов  и  когда  она  перестанет  начинаться.  Иными  словами,  если  для\nкакого-то  клиента  из  аудитории  рассылки  первый  блок  рассылки  не  успеет\nвыполниться в заданный промежуток времени, то рассылка для этого клиента уже не\nначнется;\n•  Две  группы  с  одинаковыми  настройками,  определяющих,  как  рассылка  должна\nпроводиться в рабочие и в выходные дни.\nВ каждой группе задаются следующие параметры:\n•  «Часы  работы»  —  часы,  в  которые  рассылка  будет  пытаться  начаться  для\nочередной подгруппы клиентов;\n•  «Отправлять каждые» — интервал, через который рассылка будет начинаться для\nследующей группы клиентов;\n•  «Максимальное количество клиентов за одну отправку» — размер группы клиентов,\nдля  которых  рассылка  будет  начинаться  через  каждый  заданный  интервал\nвремени.\n6 Подробнее о режимах (состояниях) рассылки см. в разделе Возможные состояния рассылки.\n50\nПримечание:\nОдну из групп настроек можно полностью выключить, сняв флажок рядом с названием.\nВ этом случае она применяться не будет.\nНапример, с настройками как на рисунке далее рассылка будет начинаться каждые 10\nминут для очередных 100 клиентов из множества всех клиентов аудитории рассылки.\nРисунок 76 — Ввод дополнительных настроек для условия «Начинать в заданное время и\nотправлять равномерно»\nВажно!\nДни и часы, заданные в настройках равномерной рассылки, могут противоречить дням и\nчасам,  заданным  в  группе  Время,  когда  запланированные  действия  рассылки  не\nвыполняются. В этом случае приоритет имеют настройки исключения времени. Т. е. если\n51\nодин  и  тот  же  день  задан  в  настройках  равномерной  рассылки  и  в  настройках\nисключения, то рассылка в этот день начинаться не будет.\nКроме  того,  нужно  учитывать,  что  настройка  времени  равномерной  рассылки\nприменяется  в  часовом  поясе  компании,  а  настройка  исключения  по  времени  —  в\nчасовом поясе клиента.\nНачинать в заданное время и отправлять равномерно (аудитория из внешней системы)\nПри  выборе  этого  варианта,  как  и  в  предыдущем  случае,  рассылка  начинается  для\nклиентов  равномерно,  одинаковыми  «порциями»  через  заданный  период  времени.\nНапример,  можно  начинать  рассылку  для  очередных  100  клиентов  через  каждые  два\nчаса.  Отличие  от  предыдущего  случая  состоит  в  источнике клиентов.  В  данном  случае\nсписок клиентов, для которых начнется рассылка, загружается динамически из внешнего\nREST-сервиса  при  каждой  попытке  начать  рассылку,  а  не  из  файла как  в  предыдущем\nслучае.\nДля примера рассмотрим рассылку с настройками как на рисунке ниже:\nРисунок 77 – Основные настройки равномерной рассылки с аудиторией из внешней системы\nПосле запуска такой рассылки Marketer будет каждые 40 минут запрашивать па адресу\n«http://example.com/api/v1/customers»  список  из  200  клиентов  в  определенном\nформате (описан ниже). После проверки полученных данных рассылка начнется для этих\nклиентов.  То  же  самое  произойдет  еще  через  40  минут  и  так  далее  в  зависимости  от\nдругих настроек рассылки, которые позволяют ограничить эти запросы по времени. При\nэтом если сервер повторно отдаст клиента, для которого эта рассылка уже началась, то\nрассылка не начнется для него повторно. Все клиенты, для которых рассылка успешно\nначалась, будут отображаться на вкладке «Целевая аудитория».\nНастройки  рассылки  в  этом  случае  полностью  совпадают  с  настройками  обычной\nравномерной  рассылки  для  фиксированной  аудитории,  описанной  в  предыдущем\nразделе. Так же задаются часы работы в рабочие и выходные дни, общие ограничения\nпо времени работы и лимиты на количество клиентов. Подробнее это описано в разделе\n«Начинать в заданное время и отправлять равномерно».\n52\nФормат данных списка клиентов\nMarketer  выполняет  GET  запрос  по  указанному  в  поле  «URL  для  получения  аудитории»\nадресу и добавляет к нему параметр limit, в котором указывает максимальное количество\nклиентов.\nВнешний  REST-сервис  должен  отдавать  список  клиентов  в  формате,  описанном  в\nразделе «Формат файлов JSON» ниже.\nПри  этом  количество  клиентов  не  должно  превышать  значение,  заданное  в  параметре\nlimit (но может быть меньше). Это значение устанавливается маркетологом при настройке\nрассылки в полях «Максимальное количество клиентов за одну отправку» для выходных\nи  рабочих  дней  отдельно.  Если  внешний  REST-сервис  вернет  больше  клиентов,  чем\nзадано  в  limit,  то  будет  сгенерирована  ошибка,  рассылка  не  отправится  ни  одному\nклиенту.  Через  заданное  в  настройках  рассылки  время  будет  выполнен  следующий\nзапрос, будут выполняться те же проверки и т.д.\nНапример, в рассылке с настройками как на рисунке выше указан «URL для получения\nаудитории»\nhttp://example.com/api/v1/customers\nи «Максимальное количество клиентов за одну отправку» 200. Каждые 40 минут Marketer\nбудет выполнять запрос\nGET http://example.com/api/v1/customers?limit=200\nи этот REST-сервис должен возвращать JSON вида\n{\n\"customers\": [\n{\n\"id\": 123456,\n\"timezone\": \"Europe/Moscow\",\n\"failback_to_sms\": true,\n\"customer_data\": {\n\"first_name\": \"Gregory\"\n}\n}\n],\n\"macroses\": [\n\"name\": \"first_name\",\n\"type\": \"string\"\n{\n}\n]\n}\nВ данном случае в списке указан один клиент и рассылка начнется только для него.\n53\nЕсли  сервер  требует  авторизацию,  то  токен  может  быть  задан  в  поле  «Bearer\nавторизация»,\nРисунок 78 – параметры авторизации внешнего REST-сервиса\nВ таком случае Marketer будет выполнять запрос с HTTP-заголовком\nAuthorization: Bearer abcdefghijklmnopqrstuvwxyz\nТестирование запросов\nДля  проверки  работы  внешнего  REST-сервиса  можно  воспользоваться  кнопкой\n«Выполнить  тестовый  вызов».  Marketer  выполнит  GET  запрос  по  указанному  URL  с\nпараметрами, указанными в настройках, и частично произведет валидацию полученных\nданных.\nЕсли данные будут получены успешно и будут удовлетворять формату, описанному выше\n(см. Формат данных списка клиентов), то результат будет как на рисунке ниже:\nРисунок 79 – Успешное выполнение тестового запроса на загрузку аудитории рассылки\n54\nЕсли  Marketer  не  сможет  получить данные  по  заданному  URL, либо  их  формат  не  будет\nсоответствовать требуемому, то результат будет иметь такой вид:\nРисунок 80 – Выполнение тестового запроса завершилось ошибкой. Формат данных в ответе\nвнешнего REST-сервиса не соответствует требуемому.\nВажно!\nУспешное  выполнение  тестового  запроса  не  гарантирует  успешное  начало  рассылки\nдля клиентов при ее выполнении, т.к. некоторые проверки, например, полноты указанных\nмакросов для каждого клиента, происходят только в ходе выполнения рассылки.\nОтладка рассылок с аудиторией из внешней системы\nЕсли рассылка не начинается для клиентов в указанное время или начинается, но не для\nвсех,  можно  определить  причину  такого  поведения  системы.  Для  этого  необходимо\nскачать  журнал  запросов,  которые  выполнял  Marketer  к  внешнему  REST-сервису.  Это\nможно сделать в настройках рассылки на вкладке «Статистика»:\nРисунок 81 – Загрузка журнала запросов аудитории рассылки\nПри скачивании журнала можно применить фильтры по датам, чтобы исключить ненужные\nданные.\nРезультат представляет собой файл в формате JSON, который описывает все запросы,\nкоторые выполнял Marketer для загрузки аудитории, и результаты обработки полученных\nданных. Формат файла подробно описан ниже.\nЕсли информации о запросах за нужное время нет, это значит, что настройки рассылки\nзапрещают начинать ее в это время, или рассылка была в пассивном или отключенном\nсостоянии.\n55\nФормат файла с журналом запросов аудитории рассылки\nПоле\nurl\nresponse_json\nresponse_text\nОписание\nURL,  который  использовался  для  выполнения  запроса\nсписка клиентов.\nОтвет,  полученный  от сервера.  Задано,  только  если  в\nответе содержался валидный JSON.\nОтвет,  полученный  от  сервера.  Задано,  только  если\nответ сервера не является валидным JSON.\nmacroses\nСписок макросов, выделенных из ответа сервера.\nsuccess_customers\nduplicate_customers\nfailed_customers\nerror\nfirst_date\nlast_date\ncount\nСписок  клиентов,  для  которых  рассылка  должна\nуспешно начаться.\nСписок\nначиналась и повторно не начнется.\nклиентов,  для  которых  рассылка  уже\nСписок  клиентов,  данные  которых  не  прошли\nвалидацию. Например, не задан один из макросов или\nнет необходимых, согласно заданному формату, полей.\nСообщение об ошибке при выполнении запроса.\nДата запроса (или дата первого запроса в серии, если\ncount > 1)\nДата запроса (или дата последнего запроса в серии,\nесли count > 1)\nКоличество  запросов  в  серии  одинаковых  запросов.\nЕсли  значение  более  1,  то  это  означает,  что  между\nfirst_date  и  last_date  произошло  count  одинаковых\nошибок.  Смысл  в  том,  чтобы  не  засорять  журнал\nмножеством одинаковых записей.\nhistory_id\nИдентификатор записи в журнале.\nНачинать при получении ключевого слова\nВ этом случае рассылка начинается для тех клиентов, которые отправили боту одно из\nключевых  слов.  Ключевое  слово  должно  полностью  совпадать  с  одним  из  заданных  в\nнастройках  рассылки  текстов  (см.  Рисунок  82).  В  одну  рассылку  можно  добавить  до  10\nключевых слов.\nПодобные  рассылки  могут  использоваться  в  различных  маркетинговых  кампаниях.\nНапример, маркетолог в одной из соцсетей размещает рекламный пост с предложением\nполучить  скидку  на  товары  или  услуги.  Для  этого  клиент  должен  написать  боту\nопределенное слово или фразу, например, «ХочуСкидку». Если клиент отправляет такое\nсообщение, для него начинается рассылка – автоворонка продаж.\n56\nРисунок 82 — Настройка рассылки, которая начинается по ключевым словам\nПри проверке совпадения ключевых слов есть ряд важных особенностей:\n•  Регистр букв не учитывается. Например, если в настройках рассылки будет указано\nслово «ХочуСкидку», а клиент пришлет «хочускидку», то рассылка начнется;\n•  Пробельные  символы  до  и  после  слова/фразы  не  учитываются.  Например,  если  в\nнастройках  рассылки  будет  указано  слово  «ХочуСкидку»,  а  клиент  пришлет\n«  ХочуСкидку   », то рассылка начнется;\n•  Проверяется  совпадение  всего  сообщения  целиком.  Например,  если  в  настройках\nрассылки  будет  указано  слово  «ХочуСкидку»,  а  клиент  пришлет  «ХочуСкидку,\nпожалуйста», то рассылка не начнется;\n•  Минимальная длина ключевого слова – один символ. Например, можно использовать\nсмайлик –     .\nЕсть  ограничение, что  для  каждого  ключевого  слова  может  быть  запущена  (в  активном\nрежиме) только одна рассылка. То есть запуск двух рассылок с одним ключевым словом\nневозможен. Ограничений на существование рассылок в пассивном и других режимах,\nнастроенных на начало по одному ключевому слову, нет.\nЕще одним условием начала рассылки по ключевым словам, является состояние диалога,\nв котором клиент отправляет ключевое слово. Если клиент использует ключевое слово в\nпереписке с оператором (состояние диалога active7) или ботом (состояние диалога bot),\nто  рассылка  не  начнется.  Если  ключевое  слово  будет  использовано  при  ожидании  в\nканале (состояния диалога waiting), то рассылка начнется, но клиент будет уведомлен о\nтом, что ожидание в канале прервано и он вернулся к боту. Ниже представлена Таблица\n2, описывающая поведение бота при использовании ключевых слов в разных состояниях\nдиалога.\n7  Подробнее  состояния  диалогов  описаны  в  Руководстве  оператора  в  разделе  «Приложение  Б.  Статусы\nобработки обращений»\n57\nТаблица 2 — Состояние диалога во время начала рассылки по ключевым словам\nСостояние диалога\nwaiting\nclosed\nbot\nactive\nли\nМожет\nначаться\nрассылка  по  ключевым\nсловам?\n*\n* - При использовании ключевого слова обращение к оператору будет отклонено. Клиент\nбудет уведомлен об этом и перемещен в канал bot. После этого начнется рассылка по\nключевым словам.\nЧтобы рассылка больше не начиналась для клиентов, нужно либо задать дату с временем\nокончания рассылки, либо вручную остановить рассылку или перевести ее в пассивный\nрежим.\nНачинать при выставлении тега\nВ этом случае рассылка стартует для тех клиентов, которые после ее запуска получили\nодин из заданных тегов. Если тег уже был выставлен ранее, то рассылка не стартует.\nЕсли после запуска рассылки тег был выставлен дважды, т. е. сначала выставлен, потом\nудален, а затем снова выставлен, то рассылка может прийти клиенту дважды. Может  —\nпотому что есть другая опция, регулирующая это поведение, об этом далее в подразделе\nРасширенные настройки.\nЧтобы  прекратить  запуск  рассылок  для  клиентов,  которые  получают  заданные  теги,\nнужно  остановить  рассылку  или  перевести  ее  в  пассивный  режим,  либо  задать  дату  с\nвременем окончания рассылки.\nНачинать при возникновении события\nВ этом случае сценарий рассылки будет запущен  для тех клиентов, для которых после\nзапуска  рассылки  сгенерировано  внешнее  событие.  Например,  CRM  компании  может\nсгенерировать событие «Клиент совершил покупку». Информация об этом событии вместе\nс  дополнительными  аргументами  может  быть  передана  в  консоль  маркетолога,  и  для\nклиента может быть запущена специальная рассылка.\nПодробнее об этом описано в разделе Использование событий.\nЧтобы  прекратить  запуск  рассылок  для  клиентов,  для  которых  генерируются  события,\nнужно  остановить  рассылку  или  перевести  ее  в  пассивный  режим,  либо  задать  дату  с\nвременем окончания рассылки..\nНачинать при возникновении события для заданной аудитории\nВ  этом  случае  рассылка  стартует  при  возникновении  события,  но  не  для  заданного  в\nсобытии клиента, а для указанной в настройках рассылки целевой аудитории.\n58",
      "tags": [
        "валидац",
        "диалог",
        "идентификатор",
        "макрос",
        "настройк",
        "ограничен",
        "ошибк",
        "рассылк",
        "событ",
        "тег",
        "тест"
      ]
    },
    {
      "section_id": "10_отправка_сообщения",
      "section_title": "Отправка сообщения",
      "level": 2,
      "page_start": 17,
      "page_end": 29,
      "text": "Отправка сообщения;\n2.  Отправка сообщения, содержащего конфиденциальные данные для клиента;\n3.  Перевод в канал;\n4.  Отмена отправки запланированных сообщений этой рассылки;\n5.  Отмена действия кнопок рассылки;\n6.  Вызов внешней системы;\n7.  Генерация события;\n8.  Генерация интента.\nОтправка сообщения\nСообщения могут содержать следующие элементы:\n1.  Текст  сообщения  —  текст,  который  будет  отправлен  клиенту  в  мессенджер.  Для\nввода текста используется поле стандартного блока действий (см. Рисунок 20);\n17\nРисунок 20 — Ввод текстового сообщения для отправки\nПри нажатии на id сообщения (на представленном рисунке это «916») будет открыто\nокно  редактирования,  которое  удобно  использовать  для  ввода  больших  текстов\nрассылок.\n2.  Медиа-контент  —  изображения,  видео,  аудио  и  документы,  которые  могут  быть\nдобавлены к сообщению. Поддерживаются наиболее распространенные форматы\n(см. таблицу 1).\nТаблица 1 — Рекомендуемые форматы файлов и их поддержка в мессенджерах\nТип\nФорматы\nВозможность загрузки файлов\nViber\nВКонтакте\nTelegram\nFacebook*\nInstagram1*\nJPG\nJPEG\nPNG\nMP4\nMP3\nPDF\nDOC(X)\nXLS(X)\nTXT\nИзображение\nВидео\nАудио\nДокумент\nВажно!\nДа\nДа\nДа\nДа\nНет\nНет\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nДа\nСписок  рекомендованных  форматов,  указанный  в  таблице\n1,  не  является\nисчерпывающим.  У  каждого  мессенджера  есть  свой  список,  который  со  временем\nможет  изменяться.  Кроме  того,  необходимо  учитывать,  что  мессенджеры  имеют  свои\nособенности отображения медиа-контента (например, Viber в некоторых случаях не\nпозволяет просматривать изображения в мессенджере).\n1  Отправка  возможна  для  всех  видов  контента.  При  этом,  для  всех  видов  контента,  кроме  изображений,\nотправляется только ссылка на него. Соответственно, клиент не сможет просматривать аудио, видео или\nдокумент  прямо  в  мессенджере  (для  этого  нужно  будет  воспользоваться  браузером  или  другим\nприложением.\n18\nВ  таблице  приведены  наиболее  универсальные форматы,  подходящие  для  отправки\nклиенту  в  большинство  мессенджеров.  Перед  запуском  рассылки  для  клиентов\nнеобходимо предварительно тестировать рассылки на всех мессенджерах.\nДополнительно  нужно  учитывать,  что  для  некоторых  мессенджеров  важно,  чтобы\nистинный  формат  файла  соответствовал  его  расширению  (т. е.  чтобы  изображение\nimage.png действительно имело содержимое, предусмотренное форматом PNG, а не,\nнапример, данные в формате JPEG).\nДля добавления медиа-контента необходимо в блоке действий нажать на кнопку\nв раскрывшемся меню выбрать пункт «Добавить медиа» (см. Рисунок 21).\nи\nРисунок 21 — Переход к добавлению медиа-контента\nЗатем нужно задать тип медиа-контента и ввести ссылку (URL) на него, либо загрузить\nс компьютера при помощи кнопки\n(см. Рисунок 22).\nРисунок 22 — Добавление медиа-контента\n3.  Медиа группа — изображения и видео, которые могут быть добавлены к сообщению\nгруппой.\nВ  отличии  от  предыдущего  пункта,  медиа  группа  позволяет  отправлять  клиенту\nзаранее не определенное количество изображений и видео. Это удобно, например,\nдля  информирования  клиентов  о  результате  проведенных  работ,  когда  одному\n19\nклиенту  нужно  отправить  10  фотографий,  а  другому  15.  С  помощью  медиа  групп  это\nможно сделать одной рассылкой2.\nВторое отличие от одиночных медиа состоит в том, что с медиа группа отправляются\nклиенту  одним  сообщением3,  тогда  как  одиночные  медиа  отправляются  каждое  в\nотдельном сообщении.\nВ  группах  могут  отправляться  только  изображения  и  видео,  документы  и  аудио\nотправляться не могут.\nДля  добавления  группы  необходимо  в  блоке  действий  нажать  на  кнопку\nраскрывшемся меню выбрать пункт «Добавить медиа группу» (см. Рисунок 23).\nи  в\nРисунок 23 — Добавление медиа группы\nВ  открывшемся  окне  можно  добавлять  и  редактировать  ссылки  на  файлы,  которые\nбудут отправляться вместе с указанным сообщением (Рисунок 24).\nРисунок 24 — Редактор медиа групп\n2  Для  реализации  этого  сценария  необходимо  использовать  макросы,  см.  в  разделе  «Использование\nмакросов»\n3  Возможности просмотра одиночных и групп медиа («карусель», предпросмотр в виде плиток и т.д.) зависят\nот мессенджера.\n20\nВ  поле  URL  можно  вставить  как  сам  URL  изображения,  так  и  макрос  (подробнее  о\nмакросах в разделе «Использование макросов»).\nДля  загрузки  файлов  с  устройства  используется  кнопка\n.  Для  клонирования\nэлементов  –\nпоявившемся списке выбрать тип: изображение, видео или макрос.\n.  Для  выбора  типа  файла  необходимо  нажать  на  иконку\nи  в\nЗагруженные элементы отображаются справа. В правой области элементы можно как\nудалять  при  наведении  мышки  и  нажатии  на  кнопку  корзины,  так  и  перемещать  –\nкликнув мышкой на элемент и перетянуть в нужное место см. Рисунок 25.\nВ  левой  области\nтакже  можно  перетаскивать  элементы  и  менять  их\nпоследовательность.  Для  этого  необходимо  кликнуть  мышкой  на  элемент\nперетащить его в нужное место.\nи\nРисунок 25 — Взаимодействие с элементами в правой панели\nВажно!\nМаксимальное количество элементов в медиа группе равно 50. К одному текстовому\nсообщению может быть присоединена только одна медиа группа.\nВо всех полях медиа группы можно использовать макросы.\nРассмотрим случай, когда рассылка с медиа группой будет отправляться клиентам\nпо событию.  Ссылки на изображения мы хотим задавать динамически, в аргументах\nсобытия,  чтобы  мы  могли  отправить  одному  клиенту  11  фотографий,  а  другому  20  из\nодной рассылки. Для этого необходимо:\n1.  Создать  событие,  у  которого  будет  30  аргументов  (это  будет  максимальное\nчисло изображений в медиа группе в этом примере) (Рисунок 26);\n21\nРисунок 26 — Создание события для отправки изображений в медиа группе\n2.  Создать рассылку и настроить ее на начало по этому событию;\n3.  В конструкторе рассылки в блок добавить медиа группу;\n4.  В  медиа  группу  добавить  то  же  самое  количество  URL,  что  и  в  аргументах\nсобытия (см. Рисунок 27);\nРисунок 27 — Использование макросов с изображениями\n5.  В поле URL ввести аргументы события в фигурных скобках, указав в каждом поле\nтолько один аргумент, тип файла оставить как изображение (см. Рисунок 27);\n6.  Сохранить медиа группу.\n22\nПосле этого необходимо сгенерировать событие и в аргументах события указать\nссылки на файлы для отправки клиенту в мессенджер см. Рисунок 28.\nРисунок 28 — Генерация события с аргументами\nЕсли рассылка должна отправлять не только изображения в медиа группе, но и видео,\nтогда в макросах нужно передавать еще и тип медиа. Для этого в аргументах события\nнеобходимо  создать  в  два  раза  больше  аргументов,  чтобы  для  каждого  URL\nпередавался еще и тип, например см. Рисунок 29:\nРисунок 29 — Создания аргументов события для медиа группы\nВ настройках медиа группы для каждого URL выбираем тип \"Макрос\" и задаем URL и\nего тип макросами, как показано на Рисунок 30.\n23\nРисунок 30 — Создания медиа группы с разными типами\nПосле этого необходимо сгенерировать событие и в аргументах события указать\nссылки на файлы и типы для отправки клиенту в мессенджер, например, см. Рисунок\n31.\nРисунок 31 — Генерация события для медиа группы с типами медиа\n4.  Кнопки-действия — это кнопки, позволяющие выполнять следующие действия:\n•  Вызвать другой блок действий;\n•  Добавить клиенту теги;\n•  Снять теги с клиента;\n•  Отписать клиента от рассылок (всех)4.\nДля добавления кнопки-действия необходимо в блоке действий нажать на кнопку\nи в раскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 32).\n4 Действие эквивалентно тому, что клиент напишет боту команды «стоп рассылки» или «stop subscriptions»,\nсм. раздел Отписка от рассылок.\n24\nРисунок 32 — Переход к добавлению кнопки-действия\nЗатем  нужно  задать  требуемые  параметры  кнопки  и  нажать  на  кнопку  «Сохранить»\n(см.  Рисунок  33).  Для  каждой  кнопки  можно  указать  теги,  которые  будут  назначены\nклиенту (сняты с клиента), подробнее об этом см. в подразделе Работа с тегами.\nРисунок 33 — Добавление кнопки-действия\nПримечание:\nДлина заголовка кнопки должна быть не более 20 символов.\nДействия  в  блоке,  связанном  с  кнопкой,  всегда  выполняются  сразу  после  нажатия\nкнопки.  (см.  Рисунок  34).  Блок,  вызываемый  кнопкой-действием,  может  содержать\nлюбое из действий, описанных в разделе Блоки действий.\n25\nРисунок 34 — Второй блок выполняется сразу при нажатии на кнопку\nНа  одну  кнопку  клиент  может  нажать  только  один  раз.  Повторные  нажатия  не\nобрабатываются.  Если  сценарий  рассылки  предусматривает  возврат  к  блоку,\nкоторый клиент уже получал, то на кнопку можно будет нажать еще раз (см.  Рисунок\n35). В этом примере при нажатии на кнопку «Назад» клиент получит первый блок еще\nраз и именно в нем можно будет еще раз нажать на кнопку «Подробнее».\nРисунок 35 — Пример возврата\nПри  добавлении  к  сообщению  более  двух  кнопок-действий  появляется  опция\n«Разрешить только одно нажатие» (см. Рисунок 36).\nЕсли  она  установлена,  то  клиент  может  нажать  только  на  одну  кнопку  в  этом\nсообщении.  После  первого  нажатия  аналогичные  нажатия  по  другим  кнопкам  не\nобрабатываются.  Если  опция  не  установлена,  то  на  каждую  кнопку  в  сообщении\nможно нажать один раз.\n26\nРисунок 36 — В блок добавлено две кнопки-действия\nВажно!\nОписанное выше относится только к кнопкам сообщения, а не блока. В один блок может\nбыть добавлено несколько сообщений, каждое из которых будет содержать по нескольку\nкнопок. В этом случае при включенной опции «Разрешить только одно нажатие» в каждом\nсообщении можно будет нажать по одной кнопке.\nВ некоторых мессенджерах текст сообщений с кнопками может обрезаться. Т.е. клиент\nувидит  не  весь  отправленный  ботом  текст,  а  только  первые  несколько  символов.\nПредупреждение об этом всплывет справа у окна с текстом см. Рисунок 37. Например, в\nмобильной  версии  Viber  будет  отображаться  только  первые  40  символов  сообщения  с\nкнопкой, а в десктопной версии – первые 10.\nРисунок 37 - Текст с кнопкой, который обрежется в некоторых мессенджерах\nЧтобы  обойти  эту  проблему  рекомендуем  добавлять  отдельное  сообщение  перед\nсообщением с кнопкой и задавать в нем основной текст, а в сообщении с кнопкой писать\nчто-то короткое см. Рисунок 38.\n27\nРисунок 38 - Добавлено отдельное сообщение\n5.  Кнопки-ссылки  —  кнопки,  позволяющие  клиенту  перейти  по  заданной  ссылке  из\nмессенджера.\nДля добавления кнопки-ссылки необходимо в блоке действий нажать на кнопку\nраскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 39).\nи в\nРисунок 39 — Переход к добавлению кнопки-ссылки\nЗатем необходимо задать название кнопки и ссылку для нее (см. Рисунок 40).\nРисунок 40 — Создание кнопки-ссылки\n28\nСсылка  клиенту  не  отображается.  Нажатия  на  кнопку-ссылку  не  могут  приводить  к\nзапуску  другого  блока  или  иным  действиям,  а  также  никак  не  учитываются  в\nстатистике.\nПримечание:\nКлиент  может  нажимать  на  ссылки  многократно,  описанные  выше  ограничения  по\nнажатиям на них не действуют.\nОтправка сообщения, содержащего конфиденциальные данные для клиента\nВ  общем случае  вся  переписка клиента  с  ботом доступна  оператору  Maxbot. Если  бот\n(например,  кодов\nиспользуется  для  отправки  конфиденциальной  информации\nподтверждения), то такую информацию необходимо скрывать от оператора.\nДля  отправки  конфиденциальной  информации  в  теле  блока  с сообщением  необходимо\nиспользовать  тег  <security>…</security>  (см  Рисунок  41).  Вставка  закрывающего  тега\nобязательна.\nРисунок 41 — Отправка конфиденциальной информации при помощи тега <security></security>\nДанные, заключенные в теге <security>, для оператора заменяются на ***. То, что увидят\nклиент и оператор при запуске такой рассылки, показано на рисунке ниже:\nРисунок 42 — Отображение содержимого тега <security> для клиента и для оператора\nНа  практике  использование  тега  <security>  будет  сопровождаться  использованием\nмакроса,  т. е.  конфиденциальная  информация  вряд  ли  будет  задаваться  в  рассылке\nстатически.  В  этом  случае  тег  <security>  нужно  использовать  следующим  образом  (см.\nРисунок 43), поместив внутрь макрос, который является аргументом события:\n29",
      "tags": [
        "аргумент",
        "блок",
        "макрос",
        "мессенджер",
        "настройк",
        "рассылк",
        "событ",
        "тег",
        "тест",
        "тип"
      ]
    }
  ]
}